<script>
  // start city
  const $startCity = "KRAKÓW"
  //cities
  const cities = {
    "Dolnośląskie": {
      "WROCŁAW" : {abbr: "DW", coor: [51.1089111,	17.0329285], zoom: 12},
      "GŁOGÓW" : "DGL",
      "JELENIA GÓRA" : "DJ",
      "Karpacz" : "DJE",
      "Kłodzko" : "DKL",
      "LEGNICA" : "DL",
      "LUBIN" : "DLU",
      "ŚWIDNICA" : "DSW",
      "WAŁBRZYCH" : "DB",
      "Złotoryja" : "DZL"
    },
    "Kujawskie": {
      "BYDGOSZCZ" : "CB",
      "TORUŃ" : "CT",
      "GRUDZIĄDZ" : "CG",
      "INOWROCŁAW" : "CIN",
      "Sępólno Krajeńskie" : "CSE",
      "WŁOCŁAWEK" : "CW"
    },
    "Lubelskie": {
      "LUBLIN" : "LU",
      "BIAŁA PODLASKA" : "LB",
      "CHEŁM" : "LC",
      "Kazimierz Dolny" : "LPUK",
      "PUŁAWY" : "LPU",
      "Szczebrzeszyn" : "LZA",
      "ZAMOŚĆ" : "LZ"
    },
    "Lubuskie": {
      "ZIELONA GÓRA" : "FZ",
      "GORZÓW WIELKOPOLSKI" : "FG"
    },
    "Łódzkie": {
      "ŁÓDŹ" : "EL",
      "BEŁCHATÓW" : "EBE",
      "Kutno" : "EKU",
      "Opoczno" : "EOP",
      "PABIANICE" : "EPA",
      "PIOTRKÓW TRYBUNALSKI" : "EP",
      "RADOMSKO" : "ERA",
      "Sieradz" : "ESI",
      "SKIERNIEWICE" : "ES",
      "TOMASZÓW MAZOWIECKI" : "ETM",
      "Zduńska Wola" : "EZD",
      "ZGIERZ" : "EZG"
    },
    "Małopolskie": {
      "KRAKÓW" : {abbr: "KR", coor: [50.0616779,	19.9373317], zoom: 12},
      "Alwernia" : "KCHA",
      "Andrychów" : "KWAA",
      "Biecz" : "KGRB",
      "Bobowa" : "KGRO",
      "Bochnia" : "KBC",
      "Brzesko" : "KBR",
      "Brzeszcze" : "KOSB",
      "Bukowno" : "KOLB",
      "Chełmek" : "KOSC",
      "Chrzanów" : "KCH",
      "Ciężkowice" : "KTAC",
      "Czchów" : "KBRC",
      "Dąbrowa Tarnowska" : "KDA",
      "Dobczyce" : "KMYD",
      "Gorlice" : "KGR",
      "Grybów" : "KNSG",
      "Jordanów": "KSUJ",
      "Kalwaria Zebrzydowska" : "KWAK",
      "Kęty" : "KOSK",
      "Koszyce" : "KPRK",
      "Krynica-Zdrój" : "KNSK",
      "Krzeszowice" : "KRAK",
      "Libiąż" : "KCHL",
      "Limanowa" : "KLI",
      "Maków Podhalański" : "KSUM",
      "Miechów" : "KMI",
      "Mszana Dolna" : "KLIM",
      "Muszyna" : "KNSM",
      "Myślenice" : {abbr: "KMY", coor: [49.8345641, 19.9382329], zoom: 14},
      "Niepołomice" : "KWIN",
      "Nowe Brzesko" : "KPRN",
      "NOWY SĄCZ" : "KN",
      "Nowy Targ" : "KNT",
      "Nowy Wiśnicz" : "KBCN",
      "Olkusz" : "KOL",
      "Oświęcim" : "KOS",
      "Piwniczna-Zdrój" : "KNSP",
      "Proszowice" : "KPR",
      "Rabka-Zdrój" : "KNTR",
      "Radłów" : "KTAR",
      "Ryglice" : "KTAG",
      "Skała" : "KRAS",
      "Skawina" : "KRAW",
      "Słomniki" : "KRAM",
      "Stary Sącz" : "KNSS",
      "Sucha Beskidzka" : "KSU",
      "Sułkowice" : "KMYS",
      "Szczawnica" : "KNTS",
      "Szczucin" : "KDAS",
      "Świątniki Górne" : "KRAT",
      "TARNÓW" : "KT",
      "Trzebinia" : "KCHT",
      "Tuchów" : "KTAT",
      "Wadowice" : "KWA",
      "Wieliczka" : "KWI",
      "Wojnicz" : "KTAW",
      "Wolbrom" : "KOLW",
      "Zakliczyn" : "KTAZ",
      "Zakopane" : "KTT",
      "Zator" : "KOSZ",
      "Żabno" : "KTAZ"
    },
    "Mazowieckie": {
      "WARSZAWA" : {abbr: "WA", coor: [52.2318999, 21.0070610], zoom: 12},
      "Ciechanów" : "WCI",
      "Garwolin" : "WG",
      "LEGIONOWO" : "WL",
      "Milanówek" : "WGM",
      "Mława" : "WML",
      "OSTROŁĘKA" : "WO",
      "OTWOCK" : "WOT",
      "PIASECZNO" : "WPI",
      "PŁOCK" : "WP",
      "PRUSZKÓW" : "WPR",
      "RADOM" : "WR",
      "SIEDLCE" : "WS" 
    },
    "Opolskie": {
      "OPOLE" : "OP",
      "Głogówek" : "OPRG",
      "KĘDZIERZYN-KOŹLE" : "OK",
      "Nysa" : "ONY",
      "Otmuchów" : "ONYO",
      "Paczków" : "ONYP",
      "Prudnik" : "OPR"
    },
    "Podkarpackie": {
      "RZESZÓW" : "RZ",
      "DĘBICA" : "RDE",
      "Jarosław" : "RJA",
      "Jasło" : "RJS",
      "KROSNO" : "RK",
      "Łańcut" : "RLA",
      "MIELEC" : "RMI",
      "Pilzno" : "RDEP",
      "PRZEMYŚL" : "RP",
      "Przeworsk" : "RPZ",
      "Radymno" : "RJAR",
      "Ropczyce" : "RRSR",
      "Sanok" : "RSA",
      "STALOWA WOLA" : "RST",
      "Sędziszów Małopolski" : "RRSS",
      "TARNOBRZEG" : "RT"
    },
    "Podlaskie": {
      "BIAŁYSTOK" : "BI",
      "SUWAŁKI" : "BS",
      "ŁOMŻA" : "BL"
    },
    "Pomorskie": {
      "GDAŃSK" : "GD",
      "GDYNIA" : "GA",
      "Hel" : "GPUH",
      "Krynica Morska" : "GNDK",
      "Łeba" : "GLEL",
      "Malbork" : "GMB",
      "RUMIA" : "GWER",
      "SŁUPSK" : "GS",
      "Sopot" : "GSP",
      "STAROGARD GDAŃSKI" : "GST",
      "TCZEW" : "GTC", 
      "Ustka" : "GSL", 
      "WEJHEROWO" : "GWE"
    },
    "Śląskie": {
      "KATOWICE" : "SK",
      "BĘDZIN" : "SBE",
      "BIELSKO-BIAŁA" : "SB",
      "Bieruń" : "SBL",
      "BYTOM" : "SY",
      "CHORZÓW" : "SH",
      "Cieszyn" : "SCI",
      "Czechowice-Dziedzice" : "SBIC",
      "Czeladź" : "SBEC",
      "CZĘSTOCHOWA" : "SC",
      "DĄBROWA GÓRNICZA" : "SD",
      "GLIWICE" : "SG",
      "JASTRZĘBIE-ZDRÓJ" : "SJZ",
      "JAWORZNO" : "SJ",
      "Mikołów" : "SMI",
      "MYSŁOWICE" : "SM",
      "Myszków" : "SMY",
      "Ogrodzieniec" : "SZAO",
      "PIEKARY ŚLĄSKIE" : "SPI",
      "Pilica" : "SZAP",
      "Pszczyna" : "SPS",
      "RACIBÓRZ" : "SRC",
      "RUDA ŚLĄSKA" : "SL",
      "RYBNIK" : "SR",
      "SIEMIANOWICE ŚLĄSKIE" : "SI",
      "Siewierz" : "SBE",
      "Sławków" : "SBES",
      "SOSNOWIEC" : "SO",
      "Szczekociny" : "SZAS",
      "Szczyrk" : "SBIS",
      "ŚWIĘTOCHŁOWICE" : "SW",
      "TARNOWSKIE GÓRY" : "STA",
      "TYCHY" : "ST",
      "Ustroń" : "SCIU",
      "WODZISŁAW ŚLĄSKI" : "SWD",
      "ZABRZE" : "SZ",
      "ZAWIERCIE" : "SZA",
      "ŻORY" : "SZO",
      "Żywiec" : "SZY",
    },
    "Świętokrzyskie": {
      "KIELCE" : "TK", 
      "Busko-Zdrój" : "TBU",
      "Chęciny" : "TKIC",
      "Jędrzejów" : "TJE",
      "Kazimierza Wielka" : "TKA",
      "OSTROWIEC ŚWIĘTOKRZYSKI" : "TOS",
      "Pacanów" : "TBUP",
      "Pińczów" : "TPI",
      "Sandomierz" : "TSA",
      "Skalbmierz" : "TKAS",
      "SKARŻYSKO-KAMIENNA" : "TSK",
      "STARACHOWICE" : "TST",
      "Stopnica" : "TBUS"
    },
    "Warmińskie": {
      "OLSZTYN" : "NO",
      "ELBLĄG" : "NE",
      "EŁK" : "NEL",
      "Frombork" : "NBRF",
      "Giżycko" : "NGI",
      "Nidzica" : "NNI",
      "Olsztynek" : "NOLO",
      "Orneta" : "NLIO"
    },
    "Wielkopolskie": {
      "POZNAŃ" : "PO",
      "GNIEZNO" : "PGN",
      "KALISZ" : "PK",
      "KONIN" : "PN",
      "LESZNO" : "PL",
      "OSTRÓW WIELKOPOLSKI" : "POS",
      "PIŁA" : "PP"
    },
    "Zachodniopomorskie": {
      "SZCZECIN" : "ZS",
      "Darłowo" : "ZSLD",
      "KOŁOBRZEG" : "ZKL",
      "KOSZALIN" : "ZK",
      "Mielno" : "ZKOM",
      "Międzyzdroje" : "ZKAM",
      "STARGARD" : "ZST",
      "Świnoujście" : "ZSW"
    }           
  }


  //data
  const data = [
    //Kraków - gastronomia
    {coor: [50.05824, 19.93895], city: 'KRAKÓW', category: 'Gastro', name: 'Taco Mexicano', url: 'Kraków/Zdjęcia/Gastro/Taco Mexicano.jpg'}, 
    {coor: [50.0545625, 19.9393433], city: 'KRAKÓW', category: 'Gastro', name: 'Pod Wawelem', url: 'Kraków/Zdjęcia/Gastro/Pod Wawelem.jpg'}, 
    {coor: [50.0661063, 19.9423367], city: 'KRAKÓW', category: 'Gastro', name: 'Glonojad', url: 'Kraków/Zdjęcia/Gastro/Glonojad.jpg'}, 
    {coor: [50.0641504, 19.9315327], city: 'KRAKÓW', category: 'Gastro', name: 'Mamma Mia', url: 'Kraków/Zdjęcia/Gastro/Mamma Mia.jpg'}, 

    //Kraków - kultura
    {coor: [50.04797, 19.93147], city: 'KRAKÓW', category: 'Kultura', name: 'Centrum Kongresowe', url: 'Kraków/Zdjęcia/Kultura/Centrum Kongresowe.jpg'}, 
    {coor: [50.05886, 19.93273], city: 'KRAKÓW', category: 'Kultura', name: 'Filharmonia Krakowska', url: 'Kraków/Zdjęcia/Kultura/Filharmonia Krakowska.jpg'}, 
    {coor: [50.07713, 19.98987], city: 'KRAKÓW', category: 'Kultura', name: 'Muzeum Lotnictwa', url: 'Kraków/Zdjęcia/Kultura/Muzeum Lotnictwa.jpg'}, 
    {coor: [50.06593, 19.95619], city: 'KRAKÓW', category: 'Kultura', name: 'Opera Krakowska', url: 'Kraków/Zdjęcia/Kultura/Opera Krakowska.jpg'}, 

    // Kraków - natura
    {coor: [50.01193, 20.01417], city: 'KRAKÓW', category: 'Natura', name: 'Park Aleksandry', url: 'Kraków/Zdjęcia/Natura/Park Aleksandry.jpg'}, 
    {coor: [50.04899, 19.91670], city: 'KRAKÓW', category: 'Natura', name: 'Park Dębnicki', url: 'Kraków/Zdjęcia/Natura/Park Dębnicki.jpg'}, 
    {coor: [50.01834, 19.99592], city: 'KRAKÓW', category: 'Natura', name: 'Park Jerzmanowskich', url: 'Kraków/Zdjęcia/Natura/Park Jerzmanowskich.jpg'}, 
    {coor: [50.0879293,	19.9203211], city: 'KRAKÓW', category: 'Natura', name: 'Park Krowoderski', url: 'Kraków/Zdjęcia/Natura/Park Krowoderski.jpg'}, 

    // Kraków - Religia
    {coor: [50.0497679, 19.9448311], city: 'KRAKÓW', category: 'Religia', name: 'Bazylika Bożego Ciała', url: 'Kraków/Zdjęcia/Religia/Bazylika Bożego Ciała [Kazimierz]/Zewnętrze.jpg'}, 
    {coor: [50.0199600, 19.9376000], city: 'KRAKÓW', category: 'Religia', name: 'Bazylika Miłosierdzia Bożego', url: 'Kraków/Zdjęcia/Religia/Bazylika Miłosierdzia Bożego [Łagiewniki]/Zewnętrze.jpg'}, 
    {coor: [50.0651600, 19.9319000], city: 'KRAKÓW', category: 'Religia', name: 'Bazylika Nawiedzenia NMP (Karmelitów) na Piasku', url: 'Kraków/Zdjęcia/Religia/Bazylika Nawiedzenia NMP (Karmelitów) na Piasku [Piasek]/Zewnętrze 1.jpg'}, 
    {coor: [50.0592465, 19.9360657], city: 'KRAKÓW', category: 'Religia', name: 'Bazylika św. Franciszka z Asyżu (Franciszkanów)', url: 'Kraków/Zdjęcia/Religia/Bazylika św. Franciszka z Asyżu (Franciszkanów) [Stare Miasto]/Zewnętrze 1.jpg'}, 

    // Kraków - twierdze

    // Małopolska
    {coor: [49.83461,19.93819], city: 'Myślenice', category: 'Ogólne', name: 'Myślenice', url: 'Polska/Zdjęcia/Myślenice.jpg'},
    {coor: [49.98383,20.05939], city: 'Wieliczka', category: 'Ogólne', name: 'Wieliczka', url: 'Polska/Zdjęcia/Wieliczka.jpg'},
    {coor: [49.88084, 20.09524], city: 'Dobczyce', category: 'Ogólne', name: 'Dobczyce', url: 'Polska/Zdjęcia/Dobczyce.jpg'},
  ]
</script>

<!DOCTYPE html>
<html>
<head>
  <title>Miasta Polski</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- favicon -->
  <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREREREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREREREREREREREREREREREAAAAAAAAAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAAAAAAAAAAAA" type="image/png">
  <!-- font awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  <!-- leaflet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html {
      color: #fff;
      background: #000;
      font-family: verdana, sans-serif;
      font-size: 14px;
      --accent: #444;
      --viewHeight: 0px;
      --marginTop: 0px;
    }

    /* header */
    .header {
      z-index: 2000;
      background-color: black;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 0 50px;
      min-height: 40px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      transition: transform 0.3s ease-out;
      box-shadow: 0 0 10px 0 black;
    }
      @media (max-width: 1800px) {
      .header {
        justify-content: center;
        }
      }
      .header.hide {
        transform: translateY(-120%);
      }
      .header_group {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 5px;
      }
      .header_pair {
        display: flex;
        flex-grow: 1;
      }
      @media (max-width: 640px) {
      .header_pair .header_label {
        min-width: 120px;
        }
      }
      .header_label {
        padding: 5px 8px;
      }
      .header_button {
        padding: 5px;
        transition: color 0.2s;
        min-width: 160px;
        text-align: center;
        cursor: pointer;
      }
        .header_button:hover {
          color: gray;
        }
        .header_button-gallery {
          font-weight: bold;
        }
      .header_select {
        flex-grow: 1;
        text-align: center;
        font-family: verdana;
        padding: 3px;
        width: 200px;
        color: #000;
        background: #fff;
        border-radius: 2px;
        transition: .2s;
      }
        .header_select:focus {
          color: var(--accent);
        }
      .header_option {
        padding: 5px;
        background: #fff;
        color: #000;
      }
      .header_bars {
        z-index: 3000;
        position: fixed;
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        top: 5px;
        right: 5px;
        font-size: 20px;
        background-color: rgb(0, 0, 0, 50%);
        transition: 0.5s
      }
        .header_bars:hover {
          background-color: rgb(0, 0, 0, 100%);
        }
      .header_emblem {
        z-index: 3000;
        position: absolute;
        height: 60px;
        top: 5px;
        left: 0;
      }

    /* gallery */
    .gallery {
      z-index: 1000;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      overflow: auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px,1fr));
      transition: top 0.3s ease-out;
      padding-bottom: 3px;
      gap: 2px;
    }
      .gallery_background {
        z-index: 900;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100vh;
        background-color: rgb(0, 0, 0, 80%);
        backdrop-filter: blur(5px);
      }
      .gallery.top {
        top: 40px;
      }
      .gallery img {
        max-width: 1000px;
        width: 100%;
        aspect-ratio: 4/3;
        object-fit: cover;
        box-shadow: 0 0 5px 0 black;
      }

    /* photo */
    .photo {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      z-index: 1100;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
    }
      .photo_group {
        position: relative;
      }
      .photo_arrow {
        font-size: 40px;
        color: #888;
        transition: 1s;
        z-index: 1;
      }
        .photo_arrow:hover {
          color: var(--accent);
          text-shadow: 0 0 20px var(--accent);
        }
      .photo_next {
        position: absolute;
        top: calc(var(--marginTop));
        padding: 40vh 50px 100%;
        right: 30px;
      }
      .photo_previous {
        position: absolute;
        top: calc(var(--marginTop));
        padding: 40vh 50px 100%;
        left: 30px;
        z-index: 2;
      }
      .photo_close {
        position: absolute;
        width: calc(100% - 100px);
        height: calc(100% - var(--marginTop) - 60px);
        top: calc(var(--marginTop) + 10px);
        left: 50px;
      }
      .photo_image {
        position: relative;
        max-width: calc(100vw - 60px);
        max-height: var(--viewHeight);
        margin: 30px;
        object-fit: cover;
        margin-top: var(--marginTop);
        box-shadow: 0 0 30px var(--accent);
      }
      .photo_name {
        font-size: 1.2rem;
        position: absolute;
        width: 100%;
        text-align: center;
        left: 0px;
        bottom: 50px;
        text-shadow: 0 0 5px #fff;
        color: #000;
        z-index: 1;
      }

    /* map */
    .map {
      width: 100%;
      min-height: 100vh;
      height: 100%;
    }

    /* marker */
    .marker {
      box-shadow: 0px 0px 2px 1px #666;
      object-fit: cover;
    }
      .marker-Ogólne {
        border: 1px solid gray;
      }
      .marker-Religia {
        border: 1px solid blue;
      }
      .marker-Kultura {
        border: 1px solid orange;
      }
      .marker-Natura {
        border: 1px solid green;
      }
      .marker-Gastro {
        border: 1px solid brown;
      }

    /* popup */
    .leaflet-popup-content-wrapper {
      background-color: #ddd;
      box-shadow: 0px 0px 10px 0px #666;
    }
      .leaflet-popup-content-wrapper .img {
        width: 100%;
        padding-top: 8px;
      }
      .leaflet-popup-content-wrapper .title {
        position: absolute;
        top: 4px;
        left: 0px;
        width: 100%;
        font-family: verdana, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        color: black;
      }
    .leaflet-popup-tip {
      background-color: #ddd;
      border: none;
    }
    .leaflet-control-zoom-in,
    .leaflet-control-zoom-out {
      display: none !important;
    }
    .leaflet-control-attribution {
      display: none;
    }

    /* display */
    .none {
      display: none;
    }
    .show {
      animation: show 0.5s;
    }
    .hide {
      animation: hide 0.5s;
    }
    @keyframes show {
      from {
        opacity: 0
      } to {
        opacity: 1
      }
    }
    @keyframes hide {
      from {
        opacity: 1
      } to {
        opacity: 0
      }
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <!-- emblem -->
  <img class="header_emblem">
  <!-- bar -->
  <div class="header_bars">
    <i class="fa-solid fa-bars"></i>
  </div>
  <div class="header hide">
    <!-- Cities -->
    <div class="header_group">
      <div class="header_pair">
        <label class="header_label" for="voivodeship">Województwo:</label>
        <select class="header_select" id="voivodeship"></select>
      </div>
      <div class="header_pair">
        <label class="header_label" for="city">Miasto:</label>
        <select class="header_select" id="city"></select>
      </div>
    </div>
    <!-- Categories -->
    <div class="header_group">
      <label class="header_label" for="Ogólne">
        <input class="header_input" type="checkbox" id="Ogólne" value="Ogólne" checked> Ogólne
      </label>
      <label class="header_label" for="Historia">
        <input class="header_input" type="checkbox" id="Historia" value="Historia" checked> Historia
      </label>
      <label class="header_label" for="Religia">
        <input class="header_input" type="checkbox" id="Religia" value="Religia" checked> Religia
      </label>
      <label class="header_label" for="Kultura">
        <input class="header_input" type="checkbox" id="Kultura" value="Kultura" checked> Kultura
      </label>
      <label class="header_label" for="Natura">
        <input class="header_input" type="checkbox" id="Natura" value="Natura" checked> Natura
      </label>
      <label class="header_label" for="Gastro">
        <input class="header_input" type="checkbox" id="Gastro" value="Gastro" checked> Gastronomia
      </label>
    </div>
    <!-- Filters -->
    <div class="header_group">
      <div class="header_button header_button-reverse">Odwróć zaznaczenie</div>
      <div class="header_button header_button-filter">Wyłącz filtr miasta</div>
      <div class="header_button header_button-gallery">Pokaż galerię</div>
    </div>
  </div>

  <!-- GALLERY -->
  <div class="gallery none"></div>
  <div class="gallery_background none"></div>

  <!-- PHOTO -->
  <div class="photo none">
    <div class="photo_arrow photo_previous"><i class="fa-solid fa-angle-left"></i></div>
    <div class="photo_group">
        <div class="photo_arrow photo_close"><i class="fa-solid fa-xmark"></i></div>
        <div class="photo_name"></div>
        <img class="photo_image">
    </img>
    </div>
    <div class="photo_arrow photo_next"><i class="fa-solid fa-angle-right"></i></div>
  </div>

  <!-- MAP -->
  <div class="map" id="map"></div>

  <script>
  // GLOBAL
    // leaflet map
    let $map
    // table of markers
    let $markers = []
    // table with filtered data
    let $filteredData = []
    // flag with info if cities filter is active
    let $isFilterActive = true
    // flag with info if gallery is open
    let $isGalleryOpen = false
    // interval for presentation
    let $interval
    // index of photo
    let $index

  // HANDLES
    const $root = document.querySelector('html');
    // header
    const $headerDiv = document.querySelector('.header')
    const $headerBars = document.querySelector('.header_bars')
    const $headerFilter = document.querySelector('.header_button-filter')
    const $headerReverse = document.querySelector('.header_button-reverse')
    const $headerGallery = document.querySelector('.header_button-gallery')
    const $headerInputs = document.querySelectorAll('.header_input')
    const $headerEmblem = document.querySelector('.header_emblem')
    // gallery
    const $galleryBackground = document.querySelector('.gallery_background')
    const $gallery = document.querySelector('.gallery')
    //photo
    const $photo = document.querySelector('.photo')
    const $photoName = document.querySelector('.photo_name')
    const $photoImage = document.querySelector('.photo_image')
    const $photoPrevious = document.querySelector('.photo_previous')
    const $photoNext = document.querySelector('.photo_next')
    //city
    const $selectVoivodeship = document.querySelector('#voivodeship');
    const $selectCity = document.querySelector('#city');

  // LISTENERS
    // window
    window.addEventListener('load', main)
    window.addEventListener('keyup', checkKeys)
    window.addEventListener('resize', changeMargin)
    // photo
    $photo.addEventListener("click", hidePhoto)
    $photoPrevious.addEventListener("click", showPreviousPhoto)
    $photoNext.addEventListener("click", showNextPhoto)
    // show/hide
    $headerBars.addEventListener('click', showHideMenu)
    $headerGallery.addEventListener('click', showHideGallery)
    $headerFilter.addEventListener('click', toggleFilter)
    // reverse checkboxes
    $headerReverse.addEventListener('click', () => {
      $headerInputs.forEach(checkbox => {
        checkbox.checked = !checkbox.checked
        prepareData()
      })
    })
    // checkboxes
    $headerInputs.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        prepareData()
      })
    })
    // cities
    $selectVoivodeship.addEventListener('change', setCities)
    $selectCity.addEventListener('change', setCity)

  // GENERAL
    // main
    function main() {
      console.log("main()")
      prepareMap()
      changeMargin()
      setVoivodeship();
      setCities();
    }

    // update data
    function prepareData() {
      console.log("prepareData()");
      filterData()
      prepareMarkers()
      prepareGallery()   
    }

    // handle keys
    function checkKeys(e) {
      console.log(`checkKeys(${e.key})`)

      if (e.key === "ArrowLeft") {
        showPreviousPhoto(e)
      }
      if (e.key === "ArrowRight") {
        showNextPhoto(e)
      }
      if (e.key === "Escape") {
        hidePhoto(e)
      }
      if (e.key === "F9") {
        showPresentation(e)
      }
    }

    // change margin
    function changeMargin(){
      console.log(`changeMargin()`)
      const windowHeight = window.innerHeight;
      const headerHeight = $headerDiv.offsetHeight
      const viewHeight = windowHeight - headerHeight - 20

      $root.style.setProperty('--viewHeight', `${viewHeight}px`)
      $root.style.setProperty('--marginTop', `${headerHeight + 10}px`) 
    }

  // DATA //
    // filter data
    function filterData() {
      console.log("filterData()");
      // filter by checkboxes state
      $filteredData = data.filter(item =>
        Array.from($headerInputs).some(checkbox => checkbox.checked && checkbox.value === item.category))
      
      // filter by city filter
      if($isFilterActive) {
        $filteredData = $filteredData.filter(item => $selectCity.value === item.city)
      }
      // add id to filtered items
      $filteredData.forEach((item, index) => item.id = index)
      console.log($filteredData);
    }

    function toggleFilter() {
      console.log(`toggleFilter(${$isFilterActive ? "disactive" : "active"})`)
      $isFilterActive = !$isFilterActive
      $headerFilter.textContent = $isFilterActive? "Wyłącz filtr miasta" : "Aktywuj filtr miasta"
      prepareData()
    }

    // set voidevodeship
    function setVoivodeship(){
      console.log(`setVoivodeship()`)
      const voivodeships = Object.keys(cities)

      $selectVoivodeship.innerHTML = ""
      voivodeships.forEach(voidevoship => {
        let newVoidevoship = document.createElement('option')
        newVoidevoship.classList.add("header_option")
        newVoidevoship.value = voidevoship
        newVoidevoship.textContent = voidevoship
        if (voidevoship == findVoivodeship($startCity)) {
          newVoidevoship.setAttribute("selected", "selected")
        }
        $selectVoivodeship.appendChild(newVoidevoship)
      });
    }

    // set cities
    function setCities(){
      const newCities = cities[$selectVoivodeship.value]
      console.log(`setCities(${$selectVoivodeship.value}): ${Object.keys(newCities)}`);

      $selectCity.innerHTML ="";
      Object.keys(newCities).forEach(city => {
        let newCity = document.createElement('option')
        newCity.classList.add("header_option")
        newCity.value = city
        newCity.textContent = city
        if (city == $startCity) {
          newCity.setAttribute("selected", "selected")
        }
        $selectCity.appendChild(newCity)
      });
      document.title = $selectCity.value
      console.log($selectCity.value);

      setTimeout(() => {
        setEmblem($selectCity.value)
        setView($selectCity.value)
        prepareData()
      }, 0);

    }
    // set city
    function setCity() {
      console.log(`setCity(${$selectCity.value})`)
      document.title = $selectCity.value

      setEmblem($selectCity.value)
      setView($selectCity.value)
      prepareData()
    }
    // set emblem of city
    function setEmblem(city) {
      const voidevodeship = findVoivodeship(city)
      const capitalizedCity = capitalizeCity(city)
      const path = `Polska/${voidevodeship}/${capitalizedCity}/${capitalizedCity}.gif`
      $headerEmblem.setAttribute("src", path)
      $headerEmblem.setAttribute("alt", "Herb")

      console.log(`setEmblem(${path})`)
    }
    // find voivodeship
    function findVoivodeship(city) {
      for (let voivodeship in cities) {
        if (city in cities[voivodeship]) {
          return voivodeship
        }
      }
    }
    // capitalize name of city
    function capitalizeCity(city) {
      let capitalizedCity = city.toLowerCase()
      capitalizedCity = capitalizedCity.charAt(0).toUpperCase() + capitalizedCity.slice(1)
      return capitalizedCity
    }

  // HEADER
    function showHideMenu () {
      console.log("showHideMenu()");
      $headerDiv.classList.toggle('hide')
      $gallery.classList.toggle('top')
    }

  // GALLERY //
    // show and hide gallery
    function showHideGallery (e) {
      console.log(`showHideGallery(${$isGalleryOpen ? "hide" : "show"})`)
      if (! $isGalleryOpen) {
        $gallery.classList.remove('none')
        $gallery.classList.add('show')
        $galleryBackground.classList.remove('none')
        $galleryBackground.classList.add('show')
        $headerGallery.textContent = "Ukryj galerię"
        $isGalleryOpen = true

      } else {              
        $gallery.classList.add('hide')
        $galleryBackground.classList.add('hide')
        $headerGallery.textContent = "Pokaż galerię"
        $isGalleryOpen = false
        hidePhoto(e)

        setTimeout(() => {
          $gallery.classList.remove('hide')
          $gallery.classList.remove('show')
          $gallery.classList.add('none')
          $galleryBackground.classList.remove('hide')
          $galleryBackground.classList.remove('show')
          $galleryBackground.classList.add('none')
        }, 400);
      }
    }

    // prepare gallery
    function prepareGallery() {
      console.log("prepareGallery()");
      //clear gallery
      $gallery.innerHTML = ""
      // create imgs for filtered table
      $filteredData.forEach(item => {
        const img = document.createElement("img")
        img.setAttribute("src", item.url)
        img.setAttribute("alt", item.name)
        img.setAttribute("title", item.name)
        img.setAttribute("id", item.id)
        img.addEventListener("click", showSelectedPhoto)
        $gallery.appendChild(img)
      })
    }

  // PHOTOS
    // show photo
    function showPhoto(imgID) {
      console.log(`showPhoto(${imgID})`)
      if (imgID == 0) {
        $photoPrevious.classList.add("none")
      } else {
        $photoPrevious.classList.remove("none")
      }

      if (imgID == $filteredData.length - 1) {
        $photoNext.classList.add("none")
      } else {
        $photoNext.classList.remove("none")
      }

      const image = document.getElementById(imgID)
      $photoImage.setAttribute("src", image.src)
      $photoImage.setAttribute("title", image.title)
      $photoName.textContent = image.title;
    }

    // show presentation
    function showPresentation(e) {
      console.log("showPresentation()")

      $photo.classList.remove("none")
      $photo.classList.add("show")

      showPhoto(0)
      $index = 0;

      $interval = setInterval(() => {
        if ($index < $filteredData.length - 1) {
          showNextPhoto(e)
        } else {
          clearInterval($interval)
          hidePhoto(e)
        }
      }, 3000);
    }

    // show selected photo
    function showSelectedPhoto(e) {      
      $photo.classList.remove("none")
      $photo.classList.add("show")

      let imgID = e.target.closest("img").id

      showPhoto(imgID)
      $index = imgID;

      console.log(`showSelectedPhoto(${$index})`)
    }

    // show previous photo
    function showPreviousPhoto(e){
      console.log("showPreviousPhoto()")

      e.stopPropagation()
      if ($index > 0) {
        $index = parseInt($index) - 1
        showPhoto($index)
      } 
    }

    // show next photo
    function showNextPhoto(e) {
      console.log("showNextPhoto()")
      
      e.stopPropagation()
      if ($index < $filteredData.length - 1) {
        $index = parseInt($index) + 1
        showPhoto($index)
      } 
    }

    // hide photo
    function hidePhoto(e) {
      console.log("hidePhoto()")
      clearInterval($interval)

      e.stopPropagation()
      $photo.classList.add("hide")
      setTimeout(() => {
        $photo.classList.add("none")
        $photo.classList.remove("show")
        $photo.classList.remove("hide")
      }, 400);
    }

  // MAP //
    // prepare map
    function prepareMap() {
      console.log("prepareMap()");
      // leaflet map view
      $map = L.map('map')
      // add leaflet openstreetmap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data from <a href="https://www.openstreetmap.org/">OpenStreetMap</a>', 
        maxZoom: 18}).addTo($map)
  
      // remove zoom controls
      const zoomControl = L.control.zoom()
      zoomControl.addTo($map);
      $map.removeControl(zoomControl);

      // keyboard disabled
      $map.keyboard.disable()
  
      // getting coordinates from map
      $map.on('click', (e) => {
        const lat = e.latlng.lat.toFixed(7)
        const lng = e.latlng.lng.toFixed(7)
        console.log(`${lat}\t${lng}`)
      })
    }

    // set view
    function setView(city) {
      const cityInfo = cities[findVoivodeship(city)][city]
      if (cityInfo.coor){
        $map.setView(cityInfo.coor, cityInfo.zoom)
      }
      console.log(`setView(${city}, coor:${cityInfo.coor}, zoom:${cityInfo.zoom})`)
    }

  // MARKERS //
    // set zoom of marker
    function setZoom(zoom) {
      const size = Math.pow(zoom,2) * 0.15
      return [size, size]
    }
    // set anchor of marker
    function setAnchor(zoom) {
      const size = Math.pow(zoom,2) * 0.15
      return [size * 0.5, size * 0.5]
    }
    // create content for marker popup
    function createMarkerPopup(name, url, id) {
      // <div>
      const wrapper = document.createElement("div")

      // <div class="title">${name}</div>
      const div = document.createElement("div")
      div.classList.add("title")
      div.textContent = name
      wrapper.appendChild(div)

      // <img class="img" src='${url}' alt=${name} id=${id}>
      const img = document.createElement("img")
      img.classList.add("img")
      img.setAttribute("src", url)
      img.setAttribute("alt", name)
      img.setAttribute("title", name)
      img.setAttribute("id", id)
      img.addEventListener("click", showSelectedPhoto)
      wrapper.appendChild(img)
      // </div>
      return wrapper
    }

    // create marker
    function createMarker(coor, category, name, url, id) {
      // icon
      const zoom = $map.getZoom()
      const icon = L.icon({
        iconUrl: url,
        iconSize: setZoom(zoom),
        iconAnchor: setAnchor(zoom),
        className: `marker marker-${category}`
      })
      // popup
      const popup = L.popup({
        minWidth: 400, 
        autoPanPadding: [50,50]
      }).setContent(createMarkerPopup(name, url, id))
      // marker
      const marker = L.marker(coor, {icon: icon})
      .bindPopup(popup).addTo($map)
      // add category to marker
      marker.category = category
      // add marker to table of markers
      $markers.push(marker)
    }

    // add zoom listener
    function addZoomMakers(){
      $map.on('zoomend', () => {
        const zoom = $map.getZoom()
        $markers.forEach(marker => {
          const icon = marker.options.icon
          icon.options.iconSize = setZoom(zoom)
          icon.options.iconAnchor = setAnchor(zoom)
          marker.setIcon(icon)
        })
      })
    }

    // generate markers
    function prepareMarkers() {
      console.log("prepareMarkers()");

      // remove all markers from map
      $markers.forEach(marker => $map.removeLayer(marker))
      // remove all markers from table
      $markers = []
      // create new markers
      $filteredData.forEach(item => {
        createMarker(item.coor, item.category, item.name, item.url, item.id)
      })
      // add zoom listener
      addZoomMakers()
    }

  </script>
</body>
</html>