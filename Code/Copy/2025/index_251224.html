<!-- @p TRAVELS
------------------------->
<!DOCTYPE html>
<html>
	<head>
		<!--====================-->
		<!--#region @r HEAD -->
		<!--====================-->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<!-- Favicon -->
		<link
			rel="icon"
			href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREREREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREAAAAAAAAREQAAAAAAABERAAAAAAAAEREREREREREREREREREREREAAAAAAAAAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAD/8AAA//AAAP/wAAAAAAAAAAAAA"
			type="image/png"
		/>
		<!-- Font awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
		<!-- Leaflet -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.min.js"></script>
		<!-- Scripts -->
		<script src="Code/routes.js"></script>
		<script src="Code/index.js"></script>
		<!-- Title -->
		<title>PODRÃ“Å»E</title>

		<!--#endregion -->
		<!--====================-->
		<!--#region @r STYLES -->
		<!--====================-->
		<style>
			/*------------------------*/
			/* @g GENERAL
			/*------------------------*/
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			* {
				scrollbar-width: thin;
				scrollbar-color: #222 #333;
			}
			*::-webkit-scrollbar {
				width: 10px;
			}
			*::-webkit-scrollbar-track {
				background-color: #333;
				border-radius: 20px;
			}
			*::-webkit-scrollbar-thumb {
				background-color: #222;
				border-radius: 20px;
			}
			html {
				color: #fff;
				background: #000;
				font-family: verdana, sans-serif;
				font-size: 14px;
				--accent: #4af;
				--viewHeight: 0px;
				--marginTop: 0px;
			}
			/*------------------------*/
			/* @g HEADER
			/*------------------------*/
			.header {
				z-index: 2000;
				background-color: black;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				padding: 5px 60px 5px 16px;
				min-height: 40px;
				display: flex;
				flex-wrap: wrap;
				align-items: center;
				justify-content: center;
				transition: transform 0.3s ease-out;
				box-shadow: 0 0 10px 0 black;
			}
			.header.hide {
				transform: translateY(-130%);
			}
			.header_pair {
				display: flex;
				align-items: center;
				padding: 5px 0px;
				flex-grow: 1;
			}
			@media (min-width: 1000px) {
				.header_pair {
					width: 33%;
				}
			}
			@media (min-width: 1900px) {
				.header_pair {
					width: auto;
				}
			}
			.header_label {
				text-align: right;
				width: 80px;
				padding: 5px;
			}
			.header_button {
				padding: 5px 10px;
				transition: color 0.2s;
				text-align: center;
				cursor: pointer;
			}
			.header_button:hover {
				color: gray;
			}
			.header_select {
				flex-grow: 1;
				text-align: left;
				font-family: verdana;
				padding: 5px;
				width: 160px;
				color: #fff;
				background: black;
				border-color: #333;
				border-radius: 2px;
				transition: 0.2s;
			}
			.header_select:focus {
				color: var(--accent);
			}
			.header_option {
				padding: 5px;
				background: black;
				color: white;
			}
			.header_bars {
				z-index: 3000;
				position: fixed;
				width: 30px;
				height: 30px;
				display: flex;
				justify-content: center;
				align-items: center;
				top: 10px;
				left: 10px;
				font-size: 20px;
				border-radius: 4px;
				background-color: rgb(0, 0, 0, 0.7);
				box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
				transition: 0.5s;
			}
			.header_bars:hover {
				background-color: rgb(0, 0, 0, 100%);
			}
			.header_emblem {
				z-index: 3000;
				position: fixed;
				height: 60px;
				top: 5px;
				right: 0px;
			}
			/*------------------------*/
			/* @g FOOTER
			/*------------------------*/
			.footer {
				z-index: 3000;
				position: fixed;
				bottom: 0px;
				left: 0px;
				width: 100vw;
				min-height: 32px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				background: transparent;
				transition: transform 0.3s ease-out;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
				backdrop-filter: blur(5px);
			}
			.footer.hide {
				transform: translateY(+120%);
			}
			.footer_view select {
				position: absolute;
				bottom: 0;
				left: 0;
				color: black;
				font-size: 14px;
				padding: 5px 20px;
				height: 100%;
				border: none;
				outline: none;
				text-align: left;
				background: transparent;
				font-family: verdana;
				appearance: none;
				-webkit-appearance: none;
				-moz-appearance: none;
			}
			.footer_view select option {
				background: lightgray;
				color: black;
			}
			.footer_copyright {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 14px;
				text-align: center;
				pointer-events: none;
				color: black;
			}
			@media (max-width: 600px) {
				.footer_copyright {
					display: none;
				}
			}
			.footer_distance {
				position: absolute;
				bottom: 0;
				right: 0;
				height: 100%;
				display: flex;
				justify-content: right;
				align-items: center;
				padding: 5px 20px;
				background: transparent;
				color: black;
				cursor: pointer;
				text-align: center;
				font-size: 14px;
			}
			/*------------------------*/
			/* @g GALLERY
			/*------------------------*/
			.gallery {
				z-index: 1000;
				position: fixed;
				margin-top: 0;
				left: 0;
				top: 0;
				width: 100%;
				max-height: 100vh;
				overflow: auto;
				overflow-x: hidden;
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
				transition: 0.2s;
				padding-bottom: 3px;
				gap: 0 3px;
			}
			@media (max-width: 1280px) {
				.gallery.half {
					grid-template-columns: repeat(3, auto);
				}
			}
			@media (max-width: 1000px) {
				.gallery {
					grid-template-columns: repeat(4, auto);
				}
			}
			@media (max-width: 640px) {
				.gallery {
					grid-template-columns: repeat(3, auto);
				}
				.gallery.half {
					grid-template-columns: repeat(2, auto);
				}
			}
			@media (max-width: 300px) {
				.gallery.half {
					grid-template-columns: repeat(1, auto);
				}
			}
			.gallery_background {
				z-index: 900;
				position: fixed;
				left: 0;
				top: 0;
				width: 100%;
				height: 100vh;
				transition: 0.2s;
				box-shadow: 0 0 5px 0 black;
				background-color: rgb(0, 0, 0, 80%);
				backdrop-filter: blur(5px);
			}
			.gallery_background.half {
				width: 50%;
			}
			.gallery_box {
				position: relative;
			}
			.gallery_box:hover .gallery_text {
				opacity: 1;
			}
			.gallery_text {
				font-size: 11px;
				position: absolute;
				padding: 10px;
				width: 100%;
				text-align: center;
				text-shadow: 0 0 5px #000;
				bottom: 0px;
				transition: opacity 0.2s ease-out;
				opacity: 0;
			}
			@media (max-width: 1000px) {
				.gallery_text {
					font-size: 10px;
				}
			}
			.gallery img {
				width: 100%;
				aspect-ratio: 4/3;
				object-fit: cover;
				box-shadow: 0 0 5px 0 black;
			}
			.gallery.top {
				top: var(--marginTop);
				max-height: calc(100vh - var(--marginTop));
			}
			.gallery.half {
				width: 50%;
			}
			/*------------------------*/
			/* @g PHOTO
			/*------------------------*/
			.photo {
				display: flex;
				justify-content: center;
				align-items: center;
				position: fixed;
				z-index: 4000;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-color: rgba(0, 0, 0, 0.9);
			}
			.photo_arrow {
				z-index: 2;
				display: flex;
				align-items: center;
				position: absolute;
				font-size: 30px;
				text-shadow: 0 0 3px #000;
				color: #888;
				transition: 1s;
				z-index: 1;
			}
			.photo_arrow:hover {
				text-shadow: 0 0 20px var(--accent);
				color: white;
			}
			.photo_next {
				height: 100%;
				right: 8px;
				top: 0px;
				padding: 0 10px 0 90px;
			}
			.photo_previous {
				height: 100%;
				left: 8px;
				top: 0px;
				padding: 0 90px 0 10px;
			}
			.photo_close {
				padding: 0 6px;
				right: 10px;
				top: 10px;
				z-index: 100;
			}
			.photo_play {
				font-size: 24px;
				padding: 0 6px;
				left: 10px;
				top: 13px;
				z-index: 100;
			}
			.photo_pause {
				font-size: 24px;
				padding: 0 6px;
				left: 10px;
				top: 13px;
				z-index: 100;
			}
			.photo_group {
				display: flex;
				position: relative;
				max-width: calc(100vw - 100px);
				max-height: calc(100vh - 30px);
				min-width: 300px;
				min-height: 40px;
				object-fit: cover;
				box-shadow: 0 0 30px #111;
				transition: 0.3s;
			}
			.photo_image {
				position: relative;
				max-width: calc(100vw - 100px);
				max-height: calc(100vh - 30px);
				object-fit: cover;
				transition: 0.3s;
			}
			.photo_name {
				font-size: 1.2rem;
				position: absolute;
				text-align: center;
				width: 100%;
				left: 0px;
				bottom: 5px;
				padding: 5px 15px;
				text-shadow: 0 0 5px #000;
				color: #fff;
				z-index: 1;
			}
			@media (max-height: 600px) {
				.photo_group {
					max-height: 100vh;
				}
				.photo_image {
					max-height: 100vh;
				}
			}
			@media (max-width: 1200px) {
				.photo_group {
					max-width: 100vw;
				}
				.photo_image {
					max-width: 100vw;
				}
				.photo_name {
					position: fixed;
				}
			}
			/*------------------------*/
			/* @g MAP
			/*------------------------*/
			.map {
				width: 100%;
				height: 100%;
				min-height: 100vh;
				position: fixed;
			}

			.leaflet-control-zoom-in,
			.leaflet-control-zoom-out {
				display: none !important;
			}
			.leaflet-control-attribution {
				display: none;
			}
			.leaflet-popup-content-wrapper,
			.leaflet-popup-tip {
				opacity: 0.8;
				color: #fff;
				font-family: verdana;
				background-color: #222;
				transition: opacity 0.3s ease;
				border-radius: 6px;
			}
			/*------------------------*/
			/* @g MARKERS
			/*------------------------*/
			.marker {
				box-shadow: 0px 0px 2px 1px #666;
				border: 2px solid gray;
				border-radius: 50%;
				transition: all 0.5s;
				object-fit: cover;
			}
			.marker-p {
				border-color: black;
			}
			.marker-g {
				border-color: orange;
			}
			.marker-h {
				border-color: red;
			}
			.marker-n {
				border-color: darkviolet;
			}
			.marker-o {
				border-color: mediumblue;
			}
			.marker-s {
				border-color: dodgerblue;
			}
			.marker-z {
				border-color: green;
			}
			.marker-tooltip {
				color: #fff;
				background-color: #222;
				padding: 6px;
				font-family: Verdana;
				font-size: 11px;
				white-space: pre;
				text-align: center;
				transition: opacity 0.5s ease-in-out;
				box-shadow: 0px 0px 2px 1px #666;
				border: 1px solid #222;
			}
			.leaflet-tooltip-bottom:before {
				border-bottom-color: #222 !important;
			}
			/*------------------------*/
			/* @g DISPLAY
			/*------------------------*/
			.none {
				display: none;
			}
			.show {
				animation: show 0.5s;
			}
			.hide {
				animation: hide 0.5s;
			}

			@keyframes show {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}
			@keyframes hide {
				from {
					opacity: 1;
				}
				to {
					opacity: 0;
				}
			}
		</style>
		<!--#endregion -->
	</head>
	<body>
		<!--====================-->
		<!--#region @r BODY -->
		<!--====================-->
		<!------------------------
		 @g HEADER
		------------------------->
		<!-- Bar -->
		<div class="header_bars">
			<i class="fa-solid fa-bars"></i>
		</div>

		<div class="header hide">
			<!-- Emblem -->
			<img class="header_emblem" />
			<!-- Category -->
			<div class="header_pair">
				<label class="header_label" for="category">Foto:</label>
				<select class="header_select" id="category"></select>
			</div>
			<!-- Activity -->
			<div class="header_pair">
				<label class="header_label" for="activity">Trasy:</label>
				<select class="header_select" id="activity"></select>
			</div>
			<!-- Date -->
			<div class="header_pair">
				<label class="header_label" for="date">Data:</label>
				<select class="header_select" id="date"></select>
			</div>
			<!-- Range -->
			<div class="header_pair">
				<label class="header_label" for="range">Zakres:</label>
				<select class="header_select" id="range"></select>
			</div>
			<!-- Region -->
			<div class="header_pair">
				<label class="header_label" for="region" id="labelRegion"></label>
				<select class="header_select" id="region"></select>
			</div>
			<!-- Place -->
			<div class="header_pair">
				<label class="header_label" for="place" id="labelPlace"></label>
				<select class="header_select" id="place"></select>
			</div>
		</div>

		<!------------------------
		 @g FOOTER
		------------------------->
		<div class="footer hide">
			<!-- View -->
			<div class="footer_view">
				<select class="footer_select" id="view"></select>
			</div>
			<!-- Distance -->
			<div class="footer_copyright">2025 Â© PrzemysÅ‚aw Fikas</div>
			<!-- Distance -->
			<div class="footer_distance"></div>
		</div>

		<!------------------------
		 @g GALLERY
		------------------------->
		<div class="gallery none"></div>
		<div class="gallery_background none"></div>

		<!------------------------
		 @g PHOTO
		------------------------->
		<div class="photo none">
			<!-- arrow play -->
			<div class="photo_arrow photo_play">
				<i class="fa-solid fa-play"></i>
			</div>
			<!-- arrow pause -->
			<div class="photo_arrow photo_pause none">
				<i class="fa-solid fa-pause"></i>
			</div>
			<!-- arrow close -->
			<div class="photo_arrow photo_close">
				<i class="fa-solid fa-xmark"></i>
			</div>
			<!-- arrow previous -->
			<div class="photo_arrow photo_previous">
				<i class="fa-solid fa-angle-left"></i>
			</div>
			<!-- arrow next -->
			<div class="photo_arrow photo_next">
				<i class="fa-solid fa-angle-right"></i>
			</div>
			<!-- photo group-->
			<div class="photo_group">
				<!-- image -->
				<img class="photo_image" draggable="false" />
				<!-- name -->
				<div class="photo_name"></div>
			</div>
		</div>

		<!------------------------
		 @g MAP
		------------------------->
		<div class="map" id="map"></div>

		<!--#endregion -->
		<!--====================-->
		<!--#region @r SCRIPTS -->
		<!--====================-->
		<script>
			//------------------------
			// @g GENERAL
			//------------------------

			// @b Consts
			//------------------------
			const FUTURE_YEAR = 2028
			const CURRENT_YEAR = 2025
			const startPlace = 'KRAKÃ“W'
			const mapActive = true

			// @b Modes
			//------------------------
			const modes = {
				ALL: {
					key: 'all',
					value: 'Wszystkie',
				},
				EMPTY: {
					key: '',
					value: '',
				},
				GALLERY: {
					key: 'gallery',
					value: 'ðŸ–¼ï¸ Galeria',
				},
				MAP: {
					key: 'map',
					value: 'ðŸ—ºï¸ Mapa',
				},
				MAP_GALLERY: {
					key: 'map&gallery',
					value: 'ðŸ—ºï¸ðŸ–¼ï¸ Mapa i galeria',
				},
				NONE: {
					key: 'none',
					value: 'Brak',
				},
				PLAN_CURRENT: {
					key: '0',
					value: `Plan ${CURRENT_YEAR}`,
				},
				PLAN_ALL: {
					key: 'plan',
					value: 'Planowane',
				},
				DONE: {
					key: 'done',
					value: 'Zrealizowane',
				},
			}

			// @b Categories
			//------------------------
			const categories = {
				NONE: {
					key: 'none',
					value: 'âŒ Brak',
				},
				ALL: {
					key: 'all',
					value: 'ðŸ“· Wszystkie',
				},
				PROFILE: {
					key: 'P',
					value: 'ðŸ‘¤ Profilowe',
				},
				GENERAL: {
					key: 'O',
					value: 'ðŸ“‹ OgÃ³lne',
				},
				SACRAL: {
					key: 'S',
					value: 'â›ª Sakralne',
				},
				HISTORIC: {
					key: 'H',
					value: 'ðŸ° Historyczne',
				},
				MODERN: {
					key: 'N',
					value: 'ðŸ™ï¸ Nowoczesne',
				},
				GASTRO: {
					key: 'G',
					value: 'ðŸ½ï¸ Gastronomiczne',
				},
				GREEN: {
					key: 'Z',
					value: 'ðŸŒ³ Zielone',
				},
			}

			// @b Activities
			//------------------------
			const activities = {
				NONE: {
					key: 'none',
					value: 'âŒ Brak',
				},
				ALL: {
					key: 'all',
					value: 'ðŸš© Wszystkie',
				},
				TRANSPORT_CAR: {
					key: 'transport_car',
					value: 'ðŸš— Samochodowe',
				},
				CYCLING: {
					key: 'cycling',
					value: 'ðŸš´ Rowerowe',
				},
				WALKING: {
					key: 'walking',
					value: 'ðŸš¶ Spacerowe',
				},
				HIKING: {
					key: 'hiking',
					value: 'ðŸ¥¾ Trekkingowe',
				},
				DOWNHILL_SKIING: {
					key: 'downhill_skiing',
					value: 'ðŸŽ¿ Narciarskie',
				},
				TRANSPORT_PUBLIC: {
					key: 'transport_public',
					value: 'ðŸšŒ Autokarowe',
				},
				TRANSPORT_TRAIN: {
					key: 'transport_train',
					value: 'ðŸš† Kolejowe',
				},
				TRANSPORT_BOAT: {
					key: 'transport_boat',
					value: 'ðŸ›³ï¸ Promowe',
				},
			}

			// @b Ranges
			//------------------------
			const ranges = {
				NONE: {
					key: 'BRAK',
					value: 'BRAK',
					categories: [
						categories.NONE.key,
						categories.ALL.key,
						categories.PROFILE.key,
						categories.GENERAL.key,
						categories.SACRAL.key,
						categories.HISTORIC.key,
						categories.MODERN.key,
						categories.GASTRO.key,
						categories.GREEN.key,
					],
					activities: [
						activities.NONE.key,
						activities.ALL.key,
						activities.TRANSPORT_CAR.key,
						activities.CYCLING.key,
						activities.WALKING.key,
						activities.HIKING.key,
						activities.DOWNHILL_SKIING.key,
						activities.TRANSPORT_PUBLIC.key,
						activities.TRANSPORT_TRAIN.key,
						activities.TRANSPORT_BOAT.key,
					],
				},
				WORLD: {
					key: 'EUROPA',
					value: 'EUROPA',
					categories: [
						categories.NONE.key,
						categories.ALL.key,
						categories.PROFILE.key,
						categories.GENERAL.key,
						categories.SACRAL.key,
						categories.HISTORIC.key,
						categories.MODERN.key,
						categories.GASTRO.key,
						categories.GREEN.key,
					],
					activities: [
						activities.NONE.key,
						activities.ALL.key,
						activities.TRANSPORT_PUBLIC.key,
						activities.WALKING.key,
						activities.TRANSPORT_BOAT.key,
					],
				},
				ROADS: {
					key: 'DROGI',
					value: 'DROGI',
					categories: [categories.NONE.key],
					activities: [activities.NONE.key, activities.ALL.key],
				},
				POLAND: {
					key: 'POLSKA',
					value: 'POLSKA',
					categories: [
						categories.NONE.key,
						categories.ALL.key,
						categories.PROFILE.key,
						categories.GENERAL.key,
						categories.SACRAL.key,
						categories.HISTORIC.key,
						categories.MODERN.key,
						categories.GASTRO.key,
						categories.GREEN.key,
					],
					activities: [
						activities.NONE.key,
						activities.ALL.key,
						activities.TRANSPORT_CAR.key,
						activities.CYCLING.key,
						activities.WALKING.key,
						activities.HIKING.key,
						activities.TRANSPORT_PUBLIC.key,
						activities.TRANSPORT_TRAIN.key,
					],
				},
				MOUNTAINS: {
					key: 'GÃ“RY',
					value: 'GÃ“RY',
					categories: [categories.NONE.key, categories.ALL.key, categories.PROFILE.key, categories.GENERAL.key],
					activities: [
						activities.NONE.key,
						activities.ALL.key,
						activities.CYCLING.key,
						activities.HIKING.key,
						activities.DOWNHILL_SKIING.key,
					],
				},
			}
			// @b Globals
			//------------------------
			let $map // leaflet map
			let $distanceControl = null // distance control
			let $activityControl = null // activity control
			let $marginTop = 0 // margin top

			// Tables
			let $photos = [] // table of photos
			let $markers = [] // table of markers
			let $placesArray = [] // table with prepared data
			let $filteredData = [] // table with filtered data
			let $selectedRoutes = [] // table with selected routes
			let $routeLayers = [] // table with added routes
			// Filters
			let $viewMode = modes.MAP.key // state of view mode
			let $activityFilter = activities.ALL.key // state of activity filter
			let $categoryFilter = categories.NONE.key // state of category filter
			let $dateFilter = modes.ALL.key // state of data filter
			// Flags
			let $hoverTimeout = null // routes timeout
			let $isInitialRender = true // flag for initial render
			let $isHiglightActive = true // flag for marker higlight activ
			let $isGalleryAndMap = false // flag for gallery and map open
			let $isPhotoClicked = false // flag for photo clicked
			let $isPhotoLoading = false // flag for photo loading
			let $isPhotoOpen = false // flag for photo open
			let $isMenuOpen = false // flag for menu open
			// Photo
			let $touchStartX // touch start position
			let $touchEndX // touch end position
			let $interval // interval for presentation
			let $index = 0 // index of photo

			// @b Selectors
			//------------------------
			const $root = document.querySelector('html')
			// Header
			const $headerDiv = document.querySelector('.header')
			const $headerEmblem = document.querySelector('.header_emblem')
			const $headerBars = document.querySelector('.header_bars')
			// Footer
			const $footerDiv = document.querySelector('.footer')
			const $footerDistance = document.querySelector('.footer_distance')
			const $footerView = document.querySelector('.footer_view')
			// Gallery
			const $gallery = document.querySelector('.gallery')
			const $galleryBackground = document.querySelector('.gallery_background')
			// Photo
			const $photo = document.querySelector('.photo')
			const $photoGroup = document.querySelector('.photo_group')
			const $photoName = document.querySelector('.photo_name')
			const $photoImage = document.querySelector('.photo_image')
			const $photoPrevious = document.querySelector('.photo_previous')
			const $photoNext = document.querySelector('.photo_next')
			const $photoPause = document.querySelector('.photo_pause')
			const $photoPlay = document.querySelector('.photo_play')
			// Selects
			const $labelPlace = document.querySelector('#labelPlace')
			const $labelRegion = document.querySelector('#labelRegion')
			const $selectPlace = document.querySelector('#place')
			const $selectRegion = document.querySelector('#region')
			const $selectRange = document.querySelector('#range')
			const $selectViewMode = document.querySelector('#view')
			const $selectActivity = document.querySelector('#activity')
			const $selectCategory = document.querySelector('#category')
			const $selectDate = document.querySelector('#date')
			// Mobile
			const $isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)

			// @b Listeners
			//------------------------
			// Window
			window.addEventListener('load', main)
			window.addEventListener('keyup', checkKeys)
			window.addEventListener('resize', changeMargin)
			window.addEventListener('wheel', checkWheel)
			// Header
			$headerDiv.addEventListener('touchstart', touchstart)
			$headerDiv.addEventListener('touchmove', touchmove)
			$headerDiv.addEventListener('touchend', touchend)
			$headerBars.addEventListener('click', showHideMenu)
			$headerEmblem.addEventListener('click', showHideMenu)
			$footerDistance.addEventListener('click', clearSelectedRoutes)
			$selectPlace.addEventListener('change', setPlace)
			$selectRegion.addEventListener('change', setRegion)
			$selectRange.addEventListener('change', setRange)
			$selectViewMode.addEventListener('change', setViewMode)
			$selectActivity.addEventListener('change', setActivities)
			$selectCategory.addEventListener('change', setCategory)
			$selectDate.addEventListener('change', setDate)
			addListenersToSelects([
				$selectPlace,
				$selectRegion,
				$selectRange,
				$selectViewMode,
				$selectActivity,
				$selectCategory,
				$selectDate,
			])
			// Photo
			$photo.addEventListener('click', hidePhoto)
			$photo.addEventListener('touchstart', touchstart)
			$photo.addEventListener('touchmove', touchmove)
			$photo.addEventListener('touchend', touchend)
			$photoPlay.addEventListener('click', togglePresentation)
			$photoPause.addEventListener('click', togglePresentation)
			$photoPrevious.addEventListener('click', showPreviousPhoto)
			$photoNext.addEventListener('click', showNextPhoto)

			//------------------------
			// @g MAIN
			//------------------------
			function main() {
				Log.init()
				Log.start()
				Log.enter()
				Log.default(data)
				changeMargin()
				prepareMap()
				prepareData()
				prepareDates()
				prepareViewModes()
				prepareRanges()
				setRange()
				Log.exit()
				Log.end()
			}

			// @b Check keys
			//------------------------
			function checkKeys(e) {
				Log.enter.orange(e.key)
				if (e.key === 'ArrowLeft') {
					showPreviousPhoto(e)
				}
				if (e.key === 'ArrowRight') {
					showNextPhoto(e)
				}
				if (e.key === 'Escape') {
					hidePhoto(e)
				}
				if (e.key === 'F2') {
					showHideMenu(e)
				}
				if (e.key === 'F9') {
					togglePresentation(e)
				}
				Log.exit()
			}

			// @b Check wheel
			//------------------------
			function checkWheel(e) {
				if ($isPhotoOpen) {
					if (e.deltaY > 0) {
						showNextPhoto(e)
					} else {
						showPreviousPhoto(e)
					}
				}
			}

			// @b Check touch
			//------------------------
			function touchstart(e) {
				$touchStartX = e.touches[0].pageX
				$touchStartY = e.touches[0].pageY
				$touchEndY = $touchStartY
				$touchEndX = $touchStartX
			}
			function touchmove(e) {
				$touchEndX = e.touches[0].pageX
				$touchEndY = e.touches[0].pageY
			}
			function touchend(e) {
				const deltaX = $touchEndX - $touchStartX
				const deltaY = $touchEndY - $touchStartY
				Log.gray('touchX:', deltaX)
				Log.gray('touchY:', deltaY)
				if (deltaY < -50 && $isMenuOpen) {
					showHideMenu()
				}
				if (deltaX > 50 && $isPhotoOpen) {
					showPreviousPhoto(e)
				} else if (deltaX < -50 && $isPhotoOpen) {
					showNextPhoto(e)
				}
			}

			// @b Add selects listeners
			//------------------------
			function addListenersToSelects(selectElements) {
				selectElements.forEach(($select) => {
					let startX = 0
					let startY = 0
					const threshold = 30

					// Swipe
					$select.addEventListener(
						'touchstart',
						(e) => {
							e.stopPropagation()
							const touch = e.changedTouches[0]
							startX = touch.pageX
							startY = touch.pageY
						},
						{ passive: true }
					)

					$select.addEventListener(
						'touchend',
						(e) => {
							e.stopPropagation()
							const touch = e.changedTouches[0]
							const diffX = touch.pageX - startX
							const diffY = touch.pageY - startY

							if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > threshold) {
								const options = $select.options
								let newIndex = $select.selectedIndex

								if (diffX > 0) {
									if (newIndex < options.length - 1) newIndex++
								} else {
									if (newIndex > 0) newIndex--
								}

								if (newIndex !== $select.selectedIndex) {
									$select.selectedIndex = newIndex
									$select.dispatchEvent(new Event('change'))
								}
							}
						},
						{ passive: true }
					)

					// Scroll
					$select.addEventListener(
						'wheel',
						(e) => {
							e.preventDefault()
							e.stopPropagation()
							const options = $select.options
							let newIndex = $select.selectedIndex

							if (e.deltaY > 0) {
								// Down
								if (newIndex < options.length - 1) newIndex++
							} else {
								// Up
								if (newIndex > 0) newIndex--
							}

							if (newIndex !== $select.selectedIndex) {
								$select.selectedIndex = newIndex
								$select.dispatchEvent(new Event('change'))
							}
						},
						{ passive: false }
					)
				})
			}

			// @b Change margin
			//------------------------
			function changeMargin() {
				Log.enter()
				const windowHeight = window.innerHeight
				const headerHeight = $headerDiv.offsetHeight
				const viewHeight = windowHeight - headerHeight
				$marginTop = headerHeight

				$root.style.setProperty('--viewHeight', `${viewHeight}px`)
				$root.style.setProperty('--marginTop', `${headerHeight}px`)
				Log.exit()
			}

			//------------------------
			// @g DATA
			//------------------------

			// @b Prepare data
			//------------------------
			function prepareData() {
				Log.enter()
				$placesArray = []

				for (const range in data) {
					for (const region in data[range]) {
						for (const place in data[range][region]) {
							const placeObj = data[range][region][place]

							// Gallery photos
							if (placeObj.gallery) {
								placeObj.gallery.forEach((item) => {
									//Prepare path
									function preparePath() {
										const capitalizedPlace = capitalizeName(place)
										const capitalizedRegion = capitalizeName(region)

										// Path for mountains
										if (range == ranges.MOUNTAINS.key) {
											return `GÃ³ry/${capitalizedRegion}/${capitalizedPlace}/ZdjÄ™cia/${item.name}.jpg`

											// Path for world
										} else if (range == ranges.WORLD.key) {
											return `Åšwiat/${capitalizedRegion}/${capitalizedPlace}/ZdjÄ™cia/${item.name}.jpg`

											// Path for KrakÃ³w
										} else if (place == 'KRAKÃ“W') {
											return `KrakÃ³w/ZdjÄ™cia/${removeIcon(mapKeyToValue(categories)[item.catg])}/${item.name}.jpg`

											// Path for other cities in Poland
										} else {
											return `Polska/${capitalizedRegion}/${capitalizedPlace}/ZdjÄ™cia/${item.name}.jpg`
										}
									}

									const newItem = {
										place: place,
										region: region,
										range: range,
										coor: item.coor,
										catg: item.catg,
										date: item.date,
										name: item.name,
										scale: item.scale,
										url: preparePath(),
									}
									if (item.top) {
										newItem.top = item.top
									}
									$placesArray.push(newItem)
								})
							}
							// Profile photo
							if (placeObj.coor && placeObj.date) {
								placeObj.date.forEach((year) => {
									function prepareProfilePath() {
										let path = ''
										if (range == ranges.MOUNTAINS.key) {
											path = `GÃ³ry/ZdjÄ™cia/${capitalizeName(place)} ${year}.jpg`
										} else if (range == ranges.WORLD.key) {
											path = `Åšwiat/ZdjÄ™cia/${capitalizeName(place)}.jpg`
										} else if (range == ranges.POLAND.key) {
											path = `Polska/ZdjÄ™cia/${capitalizeName(place)}.jpg`
										}
										return path
									}

									const newItem = {
										place: place,
										region: region,
										range: range,
										coor: placeObj.coor,
										scale: placeObj.scale,
										date: [year],
										name: [year],
										catg: categories.PROFILE.key,
										url: prepareProfilePath(),
									}
									$placesArray.push(newItem)
								})
							}
						}
					}
				}
				Log.exit()
			}

			// @b Filter data
			//------------------------
			function filterData() {
				Log.enter()
				// Get data from original array
				$filteredData = $placesArray

				// Filter by range
				if ($selectRange.value !== ranges.NONE.key) {
					if ($selectRegion.value == modes.ALL.key) {
						$filteredData = $filteredData.filter((item) => $selectRange.value === item.range)
					} else if ($selectPlace.value == modes.ALL.key) {
						$filteredData = $filteredData.filter((item) => $selectRegion.value === item.region)
					} else {
						$filteredData = $placesArray.filter((item) => $selectPlace.value === item.place)
					}
				}

				// Filter by category filter
				if ($categoryFilter != categories.ALL.key) {
					$filteredData = $filteredData.filter((item) => {
						return item.catg == $categoryFilter
					})
				}
				// Filter by date filter
				if ($dateFilter != modes.ALL.key) {
					$filteredData = $filteredData.filter((item) => {
						return item.date?.some((date) => date == Number($dateFilter))
					})
				}

				// Sort data
				$filteredData = sortData($filteredData)

				// Add id to filtered items
				$filteredData.forEach((item, index) => (item.id = index))
				Log.exit()
			}

			// @b Sort data
			//------------------------
			function sortData(array) {
				const rangePriority = {
					[ranges.WORLD.key]: 1,
					[ranges.POLAND.key]: 2,
					[ranges.MOUNTAINS.key]: 3,
				}
				const categoryPriority = {
					[categories.PROFILE.key]: 1,
					[categories.GENERAL.key]: 2,
					[categories.SACRAL.key]: 3,
					[categories.HISTORIC.key]: 4,
					[categories.MODERN.key]: 5,
					[categories.GASTRO.key]: 6,
					[categories.GREEN.key]: 7,
				}
				const sacralNamePriority = {
					zewnÄ™trze: 1,
					wnÄ™trze: 2,
					organy: 3,
				}

				array.sort((a, b) => {
					// Sort by range
					const rangeA = rangePriority[findRange(a.place)] || 9
					const rangeB = rangePriority[findRange(b.place)] || 9
					if (rangeA < rangeB) return -1
					if (rangeA > rangeB) return 1

					// Sort by region
					if (findRegion(a.place) < findRegion(b.place)) return -1
					if (findRegion(a.place) > findRegion(b.place)) return 1

					// Sort by place
					if (a.place < b.place) return -1
					if (a.place > b.place) return 1

					// Sort by category
					const categoryA = categoryPriority[a.catg] || 9
					const categoryB = categoryPriority[b.catg] || 9
					if (categoryA < categoryB) return -1
					if (categoryA > categoryB) return 1

					// Ensure a.name and b.name are valid strings
					const nameA = typeof a.name === 'string' ? a.name : ''
					const nameB = typeof b.name === 'string' ? b.name : ''

					// Sort by basilica name (everything before the last "/")
					const baseNameA = nameA.substring(0, nameA.lastIndexOf('/')) || nameA
					const baseNameB = nameB.substring(0, nameB.lastIndexOf('/')) || nameB

					if (baseNameA < baseNameB) return -1
					if (baseNameA > baseNameB) return 1

					// Sort by name priority inside the same basilica
					const suffixA = nameA.substring(nameA.lastIndexOf('/') + 1).toLowerCase()
					const suffixB = nameB.substring(nameB.lastIndexOf('/') + 1).toLowerCase()

					const priorityA = sacralNamePriority[suffixA] || 4
					const priorityB = sacralNamePriority[suffixB] || 4

					return priorityA - priorityB
				})

				return array
			}

			// @b Update data
			//------------------------
			function updateData() {
				Log.enter()
				filterData()
				prepareGallery()
				prepareMarkers()
				Log.exit()
			}

			//------------------------
			// @g HEADER
			//------------------------

			// @b Show hide menu
			//------------------------
			function showHideMenu() {
				Log.start()
				if ($isMobile) {
					const el = document.documentElement
					if (el.requestFullscreen) {
						el.requestFullscreen()
					} else if (el.webkitRequestFullscreen) {
						el.webkitRequestFullscreen()
					} else if (el.msRequestFullscreen) {
						el.msRequestFullscreen()
					}
				}

				$headerDiv.classList.toggle('hide')
				$footerDiv.classList.toggle('hide')
				$photoGroup.classList.toggle('top')
				$photoImage.classList.toggle('top')
				$gallery.classList.toggle('top')
				$isMenuOpen = !$isMenuOpen
				Log.end()
			}

			// @b Prepare view modes
			//------------------------
			function prepareViewModes() {
				Log.enter()
				// prettier-ignore
				createOption(
					$selectViewMode,
					modes.MAP.key,
					modes.MAP.value,
					$viewMode
				)
				// prettier-ignore
				createOption(
					$selectViewMode,
					modes.MAP_GALLERY.key,
					modes.MAP_GALLERY.value,
					$viewMode
				)
				// prettier-ignore
				createOption(
					$selectViewMode,
					modes.GALLERY.key,
					modes.GALLERY.value,
					$viewMode
				)
				Log.exit()
			}

			// @b Prepare ranges
			//------------------------
			function prepareRanges() {
				Log.enter()
				const dataRanges = Object.keys(data)
				const selectedRange = $isInitialRender ? findRange(startPlace) : null

				Object.values(mapKeyToObject(ranges)).forEach((range) => {
					createOption($selectRange, range.key, range.value, selectedRange)
				})
				Log.exit()
			}

			// @b Prepare regions
			//------------------------
			function prepareRegions() {
				Log.enter($selectRange.value)

				if ($selectRange.value == ranges.NONE.key) {
					clearContent($selectRegion)
					clearContent($selectPlace)
					Log.exit()
					return
				}

				clearContent($selectRegion)
				createOption($selectRegion, modes.ALL.key, modes.ALL.value)

				const selectedRegion = $isInitialRender ? findRegion(startPlace) : null
				const regions = Object.keys(data[$selectRange.value])

				regions.forEach((region) => {
					createOption($selectRegion, region, region, selectedRegion)
				})
				Log.exit()
			}

			// @b Prepare places
			//------------------------
			function preparePlaces() {
				Log.enter($selectRegion.value)
				if ($selectRegion.value == modes.ALL.key || $selectRegion.value == modes.EMPTY.key) {
					clearContent($selectPlace)
					return
				}

				createOption($selectPlace, modes.ALL.key, modes.ALL.value)
				const newPlaces = data[$selectRange.value][$selectRegion.value]

				clearContent($selectPlace)
				createOption($selectPlace, modes.ALL.key, modes.ALL.value)

				const selectedPlace = $isInitialRender ? startPlace : null
				Object.keys(newPlaces).forEach((place) => {
					if (place !== 'coor' && place !== 'zoom') {
						createOption($selectPlace, place, place, selectedPlace)
					}
				})
				$isInitialRender = false
				Log.exit()
			}

			// @b Prepare activities
			//------------------------
			function prepareActivities() {
				Log.enter()
				clearContent($selectActivity)

				const selectedRange = $selectRange.value

				if (selectedRange == ranges.MOUNTAINS.key) {
					$activityFilter = activities.HIKING.key
				} else {
					$activityFilter = activities.ALL.key
				}

				const allowedActivities = Object.values(ranges).find((r) => r.key === selectedRange)?.activities ?? []

				allowedActivities.forEach((allowedActivity) => {
					const activity = mapKeyToObject(activities)[allowedActivity]
					if (activity) {
						createOption($selectActivity, activity.key, activity.value, $activityFilter)
					}
				})
				Log.exit()
			}

			// @b Prepare categories
			//------------------------
			function prepareCategories() {
				Log.enter()
				clearContent($selectCategory)

				const selectedRange = $selectRange.value
				const allowedCategories = Object.values(ranges).find((r) => r.key === selectedRange)?.categories ?? []

				allowedCategories.forEach((allowedCategory) => {
					const category = mapKeyToObject(categories)[allowedCategory]
					if (category) {
						createOption($selectCategory, category.key, category.value, $categoryFilter)
					}
				})
				Log.exit()
			}

			// @b Prepare dates
			//------------------------
			function prepareDates() {
				Log.enter()
				clearContent($selectDate)

				if ($selectRange.value === ranges.ROADS.key) {
					createOption($selectDate, modes.ALL.key, `ðŸ“… ${modes.ALL.value}`, $dateFilter)
					const roadYears = [2028, 2027, 2026, 2025, 2024, 2020, 2016, 2012, 2008, 2004, 2000]
					roadYears.forEach((year) => {
						createOption($selectDate, year, `ðŸ“… ${year}`, $dateFilter)
					})
				} else {
					// Common options for all ranges
					createOption($selectDate, modes.ALL.key, `ðŸ“… ${modes.ALL.value}`, $dateFilter)
					createOption($selectDate, modes.DONE.key, `ðŸ“… ${modes.DONE.value}`, $dateFilter)
					createOption($selectDate, modes.PLAN_ALL.key, `ðŸ“… ${modes.PLAN_ALL.value}`, $dateFilter)
					for (let year = FUTURE_YEAR; year > CURRENT_YEAR; year--) {
						createOption($selectDate, year, `ðŸ“… Plan ${year}`, $dateFilter)
					}
					createOption($selectDate, modes.PLAN_CURRENT.key, `ðŸ“… ${modes.PLAN_CURRENT.value}`, $dateFilter)
					for (let year = CURRENT_YEAR; year >= 2004; year--) {
						createOption($selectDate, year, `ðŸ“… ${year}`, $dateFilter)
					}
					createOption($selectDate, 2000, `ðŸ“… 2000`, $dateFilter)
				}

				Log.exit()
			}

			// @b Set labels
			//------------------------
			function setLabels() {
				Log.enter()
				const range = $selectRange.value

				if (range == ranges.ROADS.key) {
					$labelRegion.textContent = 'Rodzaj:'
					$labelPlace.textContent = 'Droga:'
				} else if (range == ranges.POLAND.key) {
					$labelRegion.textContent = 'Region:'
					$labelPlace.textContent = 'Miasto:'
				} else if (range == ranges.WORLD.key) {
					$labelRegion.textContent = 'PaÅ„stwo:'
					$labelPlace.textContent = 'Miasto:'
				} else if (range == ranges.MOUNTAINS.key) {
					$labelRegion.textContent = 'Pasmo:'
					$labelPlace.textContent = 'Szczyt:'
				} else if (range == ranges.NONE.key) {
					$labelRegion.textContent = ''
					$labelPlace.textContent = ''
				}
				Log.exit()
			}

			// @b Set emblem
			//------------------------
			function setEmblem() {
				Log.enter($selectPlace.value)
				if (
					$selectRange.value == ranges.ROADS.key ||
					$selectRange.value == ranges.MOUNTAINS.key ||
					$selectPlace.value == modes.ALL.key ||
					$selectPlace.value == ''
				) {
					$headerEmblem.classList.add('none')
				} else {
					$headerEmblem.classList.remove('none')

					const capitalizedPlace = capitalizeName($selectPlace.value)
					const capitalizedRegion = capitalizeName($selectRegion.value)

					let path = ''
					if ($selectRange.value == ranges.WORLD.key) {
						path = `Åšwiat/${capitalizedRegion}/${capitalizedPlace}/${capitalizedPlace}.gif`
					} else if ($selectRange.value == ranges.POLAND.key) {
						path = `Polska/${capitalizedRegion}/${capitalizedPlace}/${capitalizedPlace}.gif`
					}
					$headerEmblem.setAttribute('src', path)
					$headerEmblem.setAttribute('alt', 'Herb')
				}
				Log.exit()
			}

			// @b Set title
			//------------------------
			function setTitle() {
				let title = ''
				if ($selectRange.value == ranges.NONE.key) {
					title = 'PODRÃ“Å»E'
				} else if ($selectRegion.value == modes.ALL.key) {
					title = $selectRange.value
				} else if ($selectPlace.value == modes.ALL.key) {
					title = $selectRegion.value
				} else {
					title = $selectPlace.value
				}
				document.title = title
				Log.enter(title)
				Log.exit()
			}
			// @b Set place
			//------------------------
			function setPlace() {
				Log.start()
				Log.enter($selectPlace.value)
				setEmblem()
				setTitle()
				setMapView()
				if ($selectRange.value == ranges.ROADS.key) {
					prepareRoutes()
				}
				updateData()
				logSelects()
				Log.exit()
				Log.end()
			}

			// @b Set region
			//------------------------
			function setRegion() {
				Log.start()
				Log.enter($selectRegion.value)
				preparePlaces()
				setEmblem()
				setTitle()
				setMapView()
				if ($selectRange.value == ranges.ROADS.key) {
					prepareRoutes()
				}
				updateData()
				logSelects()
				Log.exit()
				Log.end()
			}

			// @b Set range
			//------------------------
			function setRange() {
				Log.start()
				Log.enter($selectRange.value)
				prepareActivities()
				prepareCategories()
				prepareRegions()
				preparePlaces()
				setLabels()
				setEmblem()
				setTitle()
				setMapView()
				prepareDates()
				prepareRoutes()
				updateData()
				logSelects()
				Log.exit()
				Log.end()
			}

			// @b Set view mode
			//------------------------
			function setViewMode() {
				Log.start()
				Log.enter($selectViewMode.value)

				$viewMode = $selectViewMode.value
				// Add class to gallery and background
				function classAdd(className) {
					$gallery.classList.add(className)
					$galleryBackground.classList.add(className)
				}
				// Remove class from gallery and background
				function classRemove(className) {
					$gallery.classList.remove(className)
					$galleryBackground.classList.remove(className)
				}

				if ($viewMode == modes.MAP.key) {
					$isGalleryAndMap = false
					hidePhoto()
					classAdd('hide')
					setTimeout(() => {
						$isHiglightActive = true
						classRemove('hide')
						classRemove('show')
						classAdd('none')
					}, 400)
				} else if ($viewMode == modes.MAP_GALLERY.key) {
					$isGalleryAndMap = true
					classRemove('none')
					classAdd('show')
					classAdd('half')
					setTimeout(() => {
						$isHiglightActive = true
					}, 1000)
				} else if ($viewMode == modes.GALLERY.key) {
					$isGalleryAndMap = false
					$isHiglightActive = false
					classRemove('none')
					classRemove('half')
					classAdd('show')
				}
				setMapView()
				Log.exit()
				Log.end()
			}

			// @b Set activities
			//------------------------
			function setActivities() {
				Log.start()
				Log.enter($selectActivity.value)
				$activityFilter = $selectActivity.value
				prepareRoutes()
				logSelects()
				Log.exit()
				Log.end()
			}

			// @b Set category
			//------------------------
			function setCategory() {
				Log.start()
				Log.enter($selectCategory.value)
				$categoryFilter = $selectCategory.value
				updateData()
				logSelects()
				Log.exit()
				Log.end()
			}

			// @b Set dates
			//------------------------
			function setDate() {
				Log.start()
				Log.enter($selectDate.value)
				$dateFilter = $selectDate.value
				prepareRoutes()
				updateData()
				logSelects()
				Log.exit()
				Log.end()
			}

			//------------------------
			// @g GALLERY
			//------------------------

			// @b Prepare gallery
			//------------------------
			function prepareGallery() {
				Log.enter()
				// Clear gallery
				clearContent($gallery)
				// Create imgs for filtered table
				$filteredData.forEach((item) => {
					let description = `${item.place}: ${item.name}`

					// Gallery box
					const box = document.createElement('div')
					box.className = 'gallery_box'
					box.isClicked = false

					// Gallery text
					const text = document.createElement('div')
					text.className = 'gallery_text'
					text.textContent = description
					text.setAttribute('id', item.id)
					text.addEventListener('click', (e) => showClickedPhoto(box)(e))
					text.addEventListener('mouseover', highlightMarker)
					text.addEventListener('mouseout', resetMarker)

					// Gallery img
					const img = document.createElement('img')
					img.setAttribute('src', item.url)
					img.setAttribute('alt', description)
					img.setAttribute('id', item.id)
					img.addEventListener('click', (e) => showClickedPhoto(box)(e))
					img.addEventListener('mouseover', highlightMarker)
					img.addEventListener('mouseout', resetMarker)

					box.appendChild(img)
					box.appendChild(text)
					$gallery.appendChild(box)
					$photos.push(box)
				})
				Log.exit()
			}

			// @b Show photo
			//------------------------
			function showPhoto(imgID) {
				Log.enter(imgID)

				if ($isPhotoLoading) return
				$isPhotoLoading = true

				if (imgID == 0) {
					$photoPrevious.classList.add('none')
				} else {
					$photoPrevious.classList.remove('none')
				}

				if (imgID == $filteredData.length - 1) {
					$photoNext.classList.add('none')
				} else {
					$photoNext.classList.remove('none')
				}

				const image = document.getElementById(String(imgID))
				if (!image) {
					console.warn(`Brak elementu o ID ${imgID}`)
					$photoName.textContent = 'Nie znaleziono zdjÄ™cia.'
					$isPhotoLoading = false
					return
				}
				$photoImage.setAttribute('src', image.src)

				let loadingTimeout = setTimeout(() => {
					$photoName.textContent = 'Åadowanie zdjÄ™cia...'
				}, 500)

				Log.gray(`Photo ${imgID} loading...`)
				$photoImage.onload = () => {
					clearTimeout(loadingTimeout)
					$photoName.textContent = image.alt
					Log.gray(`Photo ${imgID} loaded.`)
					$isPhotoLoading = false
				}

				$photoImage.onerror = () => {
					clearTimeout(loadingTimeout)
					$photoName.textContent = 'ZdjÄ™cie jest niedostÄ™pne.'
					Log.error(`Photo ${imgID} loading error`)
					$isPhotoLoading = false
				}
				$isPhotoOpen = true
				Log.exit()
			}

			// @b Show clicked box
			//------------------------
			const showClickedPhoto = (clickedPhoto) => (e) => {
				Log.start('showClickedPhoto')
				Log.enter('showClickedPhoto()')

				$photos.forEach((photo) => {
					if (photo !== clickedPhoto) {
						photo.isClicked = false
					}
				})

				if ($isMobile) {
					if (clickedPhoto.isClicked) {
						showSelectedPhoto(e)
						clickedPhoto.isClicked = false
					} else {
						clickedPhoto.isClicked = true
					}
				} else {
					showSelectedPhoto(e)
				}
				Log.exit()
				Log.end()
			}

			// @b Show clicked marker
			//------------------------
			const showClickedMarker = (clickedMarker) => (e) => {
				Log.start('showClickedMarker')
				Log.enter('showClickedMarker()')

				$markers.forEach((marker) => {
					if (marker !== clickedMarker) {
						marker.isClicked = false
					}
				})

				if ($isMobile) {
					if (clickedMarker.isClicked) {
						showSelectedPhoto(e)
						clickedMarker.isClicked = false
					} else {
						clickedMarker.isClicked = true
					}
				} else {
					showSelectedPhoto(e)
				}
				Log.exit()
				Log.end()
			}

			// @b Show selected photo
			//------------------------
			function showSelectedPhoto(e) {
				let imgID = e.target.id
				Log.enter(imgID)

				showPhoto(imgID)
				$index = imgID

				setTimeout(() => {
					$photo.classList.remove('none')
					$photo.classList.add('show')
				}, 100)
				Log.exit()
			}

			// @b Show previous photo
			//------------------------
			function showPreviousPhoto(e) {
				Log.start()
				Log.enter()
				e.stopPropagation()
				if ($isPhotoLoading) {
					Log.exit()
					Log.end()
					return
				}
				if ($index > 0) {
					$index = parseInt($index) - 1
					showPhoto($index)
				}
				Log.exit()
				Log.end()
			}

			// @b Show next photo
			//------------------------
			function showNextPhoto(e) {
				Log.start()
				Log.enter()
				e.stopPropagation()
				if ($isPhotoLoading) {
					Log.exit()
					Log.end()
					return
				}
				if ($index < $filteredData.length - 1) {
					$index = parseInt($index) + 1
					showPhoto($index)
				}
				Log.exit()
				Log.end()
			}

			// @b Toggle presentation
			//------------------------
			function togglePresentation(e) {
				Log.start()
				Log.enter()

				if ($interval) {
					clearInterval($interval)
					$interval = null

					$photoPause.classList.add('none')
					$photoPlay.classList.remove('none')
				} else {
					showPhoto($index)

					$photo.classList.remove('none')
					$photo.classList.add('show')
					$photoPause.classList.remove('none')
					$photoPlay.classList.add('none')

					$interval = setInterval(() => {
						if ($isPhotoLoading) return
						if ($index < $filteredData.length - 1) {
							showNextPhoto(e)
						} else {
							$index = 0
							showPhoto($index)
						}
					}, 3000)
				}

				e?.stopPropagation()
				Log.exit()
				Log.end()
			}

			// @b Hide photo
			//------------------------
			function hidePhoto() {
				Log.start()
				clearInterval($interval)
				$interval = null

				$isPhotoOpen = false
				$photoName.textContent = ''
				$photo.classList.add('hide')
				setTimeout(() => {
					$photo.classList.add('none')
					$photo.classList.remove('show')
					$photo.classList.remove('hide')
					$photoPlay.classList.remove('none')
					$photoPause.classList.add('none')
				}, 400)
				Log.end()
			}

			//------------------------
			// @g MAP
			//------------------------

			// @b Prepare map
			//------------------------
			function prepareMap() {
				Log.enter()

				// Leaflet map view
				$map = L.map('map')

				// Add leaflet openstreetmap
				L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					attribution: 'Map data from <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
					maxZoom: 18,
				}).addTo($map)

				// Remove zoom controls
				const zoomControl = L.control.zoom()
				zoomControl.addTo($map)
				$map.removeControl(zoomControl)

				// Keyboard disabled
				$map.keyboard.disable()

				// Getting coordinates from map
				if (mapActive) {
					$map.on('click', (e) => {
						const lat = e.latlng.lat.toFixed(7)
						const lng = e.latlng.lng.toFixed(7)
						Log.orange(`${lat}, ${lng}`)
					})
				}
				Log.exit()
			}

			// @b Set map view
			//------------------------
			function setMapView() {
				Log.enter()

				if ($selectRange.value == ranges.NONE.key) {
					$map.setView(...setCoor([49.6, 12.0], 5))
					return
				}

				if ($selectRegion.value == modes.ALL.key) {
					if ($selectRange.value == ranges.MOUNTAINS.key) {
						$map.setView(...setCoor([49.5, 20.0], 9))
					} else if ($selectRange.value == ranges.POLAND.key) {
						$map.setView(...setCoor([51.9, 19.2], 7))
					} else if ($selectRange.value == ranges.ROADS.key) {
						$map.setView(...setCoor([51.9, 19.2], 7))
					} else if ($selectRange.value == ranges.WORLD.key) {
						$map.setView(...setCoor([49.6, 12.0], 5))
					} else {
						$map.setView(...setCoor([0, 0], 6))
					}
				} else if ($selectPlace.value == modes.ALL.key) {
					const region = data[$selectRange.value][$selectRegion.value]
					$map.setView(...setCoor(region.coor, region.zoom))
				} else {
					const place = data[$selectRange.value][$selectRegion.value][$selectPlace.value]
					$map.setView(...setCoor(place.coor, place.zoom))
				}
				Log.exit()
			}

			// @b Set coordinates
			//------------------------
			function setCoor(coor, zoom) {
				if (!$map || !$map._loaded) {
					return [coor, zoom]
				}

				if ($isMobile) {
					zoom -= 1
				}

				const mapZoom = $map.getZoom()
				const mapPoint = $map.latLngToContainerPoint(coor)
				const scale = Math.pow(2, zoom - mapZoom)
				const width = window.innerWidth
				const shiftX = width / 4 / scale
				const headerHeight = $headerDiv.offsetHeight || 0
				const shiftY = headerHeight / 2 / scale
				const newX = mapPoint.x - shiftX
				const newY = mapPoint.y - shiftY

				if ($isGalleryAndMap) {
					const newCoor = $map.containerPointToLatLng([newX, newY])
					return [newCoor, zoom]
				} else {
					const newCoor = $map.containerPointToLatLng([mapPoint.x, newY])
					return [newCoor, zoom]
				}
			}

			//------------------------
			// @g MARKERS
			//------------------------

			// @b Prepare markers
			//------------------------
			function prepareMarkers() {
				Log.enter()
				// Remove all markers from map
				$markers.forEach((marker) => $map.removeLayer(marker))
				// Remove all markers from table
				$markers = []
				// Create new markers
				$filteredData.forEach((item) => {
					createMarker(item)
				})
				// Add zoom listener
				addZoomToMakers()
				Log.exit()
			}

			// @b Create marker
			//------------------------
			function createMarker({ coor, place, catg, name, url, id, top, scale }) {
				// Icon
				const zoom = $map.getZoom()
				const icon = L.icon({
					iconUrl: url.replace(/(\/)([^/]+)\.([^/.]+)$/, '$1webp/$2.webp'),
					iconSize: setZoom(zoom, scale),
					iconAnchor: setAnchor(zoom, scale),
					className: `marker marker-${catg.toLowerCase()}`,
				})

				let tooltipContent = `<strong>${place}</strong>\n${name}`

				const tooltipOptions = {
					className: 'marker-tooltip',
					direction: 'bottom',
					offset: [0, 42],
					opacity: 0.8,
				}

				// Marker
				const marker = L.marker(coor, { icon: icon }).addTo($map)
				marker.id = id
				marker.catg = catg
				marker.scale = scale
				marker.isClicked = false
				marker.bindTooltip(tooltipContent, tooltipOptions)
				marker.on('mouseover', highlightMarker)
				marker.on('mouseout', resetMarker)
				marker.on('click', (e) => showClickedMarker(marker)(e))

				if (top) {
					marker.top = top
					marker.setZIndexOffset(1)
				}
				$markers.push(marker)
			}

			// @b Add zoom to markers
			//------------------------
			function addZoomToMakers() {
				$map.on('zoomend', () => {
					$markers.forEach((marker) => {
						updateMarkerSize(marker)
					})
				})
			}

			// @b Highlight marker
			//------------------------
			function highlightMarker(e) {
				if ($isHiglightActive) {
					const id = e.target.id
					const marker = $markers[id]
					marker.setZIndexOffset(100)
					updateMarkerSize(marker, 2)
				}
			}

			// @b Reset marker
			//------------------------
			function resetMarker(e) {
				const id = e.target.id
				const marker = $markers[id]
				if (marker.top) {
					marker.setZIndexOffset(1)
				} else {
					marker.setZIndexOffset(0)
				}
				updateMarkerSize(marker)
			}

			// @b Update marker size
			//------------------------
			function updateMarkerSize(marker, value) {
				const zoom = $map.getZoom()
				const icon = marker.options.icon
				let scale = marker.scale
				let factor = 1
				if (value) {
					factor = (value * 12) / zoom
					scale = 1
				}
				icon.options.iconSize = setZoom(zoom * factor, scale)
				icon.options.iconAnchor = setAnchor(zoom * factor, scale)
				marker.setIcon(icon)
			}

			// @b Set zoom of marker
			//------------------------
			function setZoom(zoom, scale = 1) {
				const size = Math.pow(zoom, 2) * 0.15 * scale
				return [size, size]
			}

			// @b Set anchor of marker
			//------------------------
			function setAnchor(zoom, scale = 1) {
				const size = Math.pow(zoom, 2) * 0.15 * scale
				return [size * 0.5, size * 0.5]
			}

			//------------------------
			// @g ROUTES
			//------------------------

			// @b Prepare routes
			//------------------------
			function prepareRoutes() {
				Log.enter()

				// Clear previous route data
				$routeLayers.forEach((layer) => $map.removeLayer(layer))
				$routeLayers = []
				$selectedRoutes = []

				// Sort routes
				const sortedRoutes = sortRoutes(routes)

				// Loop through all routes
				sortedRoutes.forEach((route) => {
					// Skip route if it doesn't match the active filters
					if (filterRoute(route)) return

					// Create route polyline and interactive hitbox layer
					const { polyline, hitbox } = createRouteLayer(route)

					// Add both layers to the map layer collection
					$routeLayers.push(polyline, hitbox)
				})
				countDistance()
				Log.exit()
			}
			// @b Sort routes
			//------------------------
			function sortRoutes(routes) {
				return [...routes].sort((a, b) => {
					const isAPlanned = a.year > CURRENT_YEAR
					const isBPlanned = b.year > CURRENT_YEAR

					if (isAPlanned && !isBPlanned) return -1
					if (!isAPlanned && isBPlanned) return 1

					return a.year - b.year
				})
			}

			// @b Filter route
			//------------------------
			function filterRoute(route) {
				// Filter by activity
				if ($activityFilter !== activities.ALL.key && $activityFilter !== route.activity) {
					return true
				}

				// Filter by range
				if (
					$selectRange.value !== ranges.NONE.key &&
					!(
						$selectRange.value === route.range ||
						($selectRange.value === ranges.MOUNTAINS.key && route.range === ranges.POLAND.key)
					)
				) {
					return true
				}

				// Filter for roads
				if (route.range === ranges.ROADS.key) {
					const name = route.name.split(' - ')[0]

					const roadCategoryMap = {
						A: 'Autostrady',
						S: 'Ekspresowe',
						D: 'PozostaÅ‚e',
					}

					// Determine road category
					const roadKey = Object.keys(roadCategoryMap).find((key) => name.startsWith(key))
					const roadCategory = roadCategoryMap[roadKey]

					// Filter by region (road category)
					if ($selectRegion.value !== modes.ALL.key && $selectRegion.value !== roadCategory) {
						return true
					}

					// Filter by road name
					if (
						$selectPlace.value !== modes.ALL.key &&
						$selectPlace.value !== modes.EMPTY.key &&
						$selectPlace.value !== name
					) {
						return true
					}

					// Filter by road year
					if ($dateFilter === modes.ALL.key) {
						// ALL mode: allow all routes regardless of year
					} else if ($dateFilter === modes.DONE.key) {
						// DONE mode: show only realized routes
						if (route.year > CURRENT_YEAR || route.year === 0) {
							return true // skip planned routes
						}
					} else if ($dateFilter === modes.PLAN_CURRENT.key) {
						// PLAN_CURRENT mode: show only routes up to CURRENT_YEAR
						if (route.year > CURRENT_YEAR) {
							return true // skip route from the future
						}
					} else {
						// Specific year mode: allow only routes up to and including the selected year
						if (route.year > parseInt($dateFilter)) {
							return true // skip route from the future
						}
					}
				} else {
					// Filter by yar for non-road routes

					if ($dateFilter === modes.DONE.key) {
						// DONE mode: show only realized routes
						if (route.year > CURRENT_YEAR || route.year === 0) return true
					} else if ($dateFilter === modes.PLAN_ALL.key) {
						// PLAN_ALL mode: show only planned routes
						if (route.year <= CURRENT_YEAR && route.year !== 0) return true
					} else if ($dateFilter === modes.PLAN_CURRENT.key) {
						// PLAN_CURRENT mode: show only planned routes up to CURRENT_YEAR
						if (route.year !== 0) return true
					} else if ($dateFilter !== modes.ALL.key && route.year !== parseInt($dateFilter)) {
						// Specific year selected: skip if year doesn't match the selected year
						return true
					}
				}
				return false
			}

			// @b Format route
			//------------------------
			function formatRouteInfo(route) {
				// Settings
				const defaultWeight = 2
				const defaultColor = 'black'
				const primaryColor = '#444'
				const secondaryColor = '#666'
				const planColor = 'steelblue'
				const buildColor = 'crimson'

				const primaryActivities = [
					activities.CYCLING.key,
					activities.DOWNHILL_SKIING.key,
					activities.TRANSPORT_BOAT.key,
				]
				const secondaryActivities = [activities.HIKING.key, activities.WALKING.key]

				let routeColor = defaultColor
				let routeWeight = defaultWeight
				let routeName = ''

				// Format name
				const formatName = (name) => {
					if (typeof name !== 'string') return ''
					return name.replace(/([a-z])([A-Z])/g, '$1 $2').replaceAll('-', ' - ')
				}

				// RenderName
				const renderName = (firstLine, secondLine, thirdLine) => `
					<div style="text-align: center; line-height: 1.6;">
						${firstLine ? `<div>${firstLine}</div>` : ''}
						${secondLine ? `<div>${secondLine}</div>` : ''}
						${thirdLine ? `<div>${thirdLine}</div>` : ''}
					</div>
				`

				// Roads
				if (route.range === ranges.ROADS.key) {
					const [name, date, lanes] = route.name.split(' - ')

					routeName = renderName(`<strong>${name}</strong> - ${date}`, `${route.icon} ${formatDistance(route.length)}`)

					routeLane = lanes?.[0]

					if (routeLane == 3) {
						routeWeight = 8
					} else if (routeLane == 2) {
						routeWeight = 6
					} else if (routeLane == 1) {
						routeWeight = 4
					} else {
						routeWeight = 2
					}

					if (route.year > CURRENT_YEAR) {
						routeColor = buildColor
					} else {
						routeColor = getColorForRoute(route.year)
					}
				} else {
					// Other routes
					const [date, name] = route.name.split(' - ')

					routeName = renderName(
						date,
						`<strong>${formatName(name)}</strong>`,
						`${route.icon} ${formatDistance(route.length)}`
					)

					if (primaryActivities.includes(route.activity)) {
						routeColor = primaryColor
					} else if (secondaryActivities.includes(route.activity)) {
						routeColor = secondaryColor
					}
					if (route.year > CURRENT_YEAR || route.year === 0) {
						routeColor = planColor
					}
				}
				return { routeName, routeColor, routeWeight }
			}

			// @b Create route layer
			//------------------------
			function createRouteLayer(route) {
				let toggled = false

				// Settings
				const activeColor = 'dodgerblue'
				const activeWeight = 6

				const { routeName, routeColor, routeWeight } = formatRouteInfo(route)

				// Main visible polyline
				const polyline = L.polyline(route.coords, {
					color: routeColor,
					weight: routeWeight,
				}).addTo($map)

				// Invisible hitbox for better interaction
				const hitbox = L.polyline(route.coords, {
					color: 'transparent',
					pane: 'shadowPane',
					weight: 20,
					opacity: 0,
				}).addTo($map)

				// Highlight on hover
				const highlightRoute = () => {
					if (!toggled) {
						hoverTimeout = setTimeout(() => {
							polyline.setStyle({
								weight: activeWeight,
							})
							polyline.bringToFront()
						}, 500)
					}
				}

				// Reset style on mouse out
				const resetHighlightRoute = () => {
					if (hoverTimeout) {
						clearTimeout(hoverTimeout)
						hoverTimeout = null
					}
					if (!toggled) {
						polyline.setStyle({
							weight: routeWeight,
						})
					}
				}

				// Toggle popup and active style
				const toggleRoute = () => {
					toggled = !toggled
					const routeIndex = routes.indexOf(route)

					if (toggled) {
						polyline.bringToFront()
						polyline.setStyle({
							color: activeColor,
							weight: activeWeight,
						})
						polyline.openPopup(L.latLng(route.coords[0]))
						if (!$selectedRoutes.includes(routeIndex)) {
							$selectedRoutes.push(routeIndex)
						}
					} else {
						polyline.closePopup()
						polyline.setStyle({
							color: routeColor,
							weight: routeWeight,
						})
						const index = $selectedRoutes.indexOf(routeIndex)
						if (index !== -1) {
							$selectedRoutes.splice(index, 1)
						}
					}
					countDistance()
				}

				// Bind events
				hitbox.on('mouseover', highlightRoute)
				hitbox.on('mouseout', resetHighlightRoute)
				hitbox.on('touchstart', toggleRoute)
				hitbox.on('click', toggleRoute)

				// Add popup
				polyline.bindPopup(routeName)

				// Return polyline and hitbox
				return {
					polyline,
					hitbox,
				}
			}

			// @b Get color for route
			//------------------------
			function getColorForRoute(year) {
				const minYear = 2000
				const maxYear = 2025

				// Clamp year
				const clampedYear = Math.max(minYear, Math.min(maxYear, year))

				// Normalize to 0â€“1
				const ratio = (clampedYear - minYear) / (maxYear - minYear)

				// Map to 0â€“255
				const r = 0
				const g = Math.round(0 + ratio * 128)
				const b = Math.round(0 + ratio * 255)

				// Convert to HEX
				const toHex = (x) => x.toString(16).padStart(2, '0')
				return `#${toHex(r)}${toHex(g)}${toHex(b)}`
			}

			// @b Clear selected routes
			//------------------------
			function clearSelectedRoutes() {
				$selectedRouteIndexes = []
				prepareRoutes()
			}

			// @b Count distance
			//------------------------
			function countDistance() {
				Log.enter()

				const visibleRoutes = [...routes].filter((route) => !filterRoute(route))
				const totalLength = visibleRoutes.reduce((sum, r) => sum + r.length, 0)

				const selectedLength = $selectedRoutes.reduce((sum, index) => {
					const route = routes[index]
					if (!filterRoute(route)) {
						return sum + route.length
					}
					return sum
				}, 0)

				$footerDistance.textContent =
					$selectedRoutes.length > 0
						? `ðŸ”„ ${formatDistance(selectedLength)} / ${formatDistance(totalLength)}`
						: formatDistance(totalLength)
				Log.exit()
			}

			//------------------------
			// @g TOOLS
			//------------------------

			// @b Find range
			//------------------------
			function findRange(place) {
				for (const range in data) {
					for (const region in data[range]) {
						if (place in data[range][region]) {
							return range
						}
					}
				}
				return ranges.POLAND.key
			}

			// @b Find region
			//------------------------
			function findRegion(place) {
				for (const range in data) {
					for (const region in data[range]) {
						if (place in data[range][region]) {
							return region
						}
					}
				}
			}

			// @b Remove icon
			//------------------------
			function removeIcon(text) {
				return text?.split(' ').slice(1).join(' ') || text
			}

			// @b Capitalize name
			//------------------------
			function capitalizeName(place) {
				return place.toLowerCase().replace(/(?:^|\s|-)([a-Å¼])/g, (match) => match.toUpperCase())
			}

			// @b Create option
			//------------------------
			function createOption(parent, value, textContent, selected) {
				const option = document.createElement('option')
				option.classList.add('header_option')
				option.value = value
				option.textContent = textContent ? textContent : value
				if (selected) {
					if (value == selected) {
						option.setAttribute('selected', 'selected')
					}
				}
				parent.appendChild(option)
			}

			// @b Clear content
			//------------------------
			function clearContent(element) {
				if (element) {
					element.innerHTML = ''
				}
			}

			// @b Format distance
			//------------------------
			function formatDistance(distance) {
				const digits = distance < 100 ? 1 : 0
				const distanceFormatted = distance.toLocaleString('pl-PL', {
					minimumFractionDigits: digits,
					maximumFractionDigits: digits,
				})
				return `${distanceFormatted} km`
			}

			// @b Map regions
			//------------------------
			function mapRegions(data) {
				const newData = {}

				for (const [regionName, regionData] of Object.entries(data)) {
					const { coor, zoom, ...data } = regionData
					const newPlaces = {}

					for (const [placeName, placeData] of Object.entries(data)) {
						const { abbr, ...rest } = placeData
						newPlaces[abbr] = rest
					}

					newData[regionName] = { coor, zoom, ...newPlaces }
				}

				return newData
			}

			// @b Map key to object
			//------------------------
			function mapKeyToObject(obj, keyName = 'key') {
				return Object.values(obj).reduce((acc, item) => {
					if (item && keyName in item) {
						acc[item[keyName]] = item
					}
					return acc
				}, {})
			}

			// @b Map key to value
			//------------------------
			function mapKeyToValue(obj, keyName = 'key', valueName = 'value') {
				return Object.values(obj).reduce((acc, item) => {
					if (item && keyName in item && valueName in item) {
						acc[item[keyName]] = item[valueName]
					}
					return acc
				}, {})
			}

			// @b Log selects
			//------------------------
			function logSelects() {
				Log.enter()
				Log.default({
					date: $dateFilter,
					activities: $activityFilter,
					categories: $categoryFilter,
					range: $selectRange.value,
					region: $selectRegion.value,
					place: $selectPlace.value,
				})
				Log.exit()
			}

			// @g Logger
			//------------------------
			const Log = {
				// @b Config
				//------------------------
				config: {
					active: true,
					maxDepth: Infinity,
					location: { active: false, style: 'font-size: 0.9em; font-style: italic; color: dimgray;' },
					divider: { active: false, style: 'font-size: 1.1em; font-weight: bold;', char: '-', length: 12 },
					group: { active: true, style: 'font-size: 1.2em; font-weight: bold;', collapsed: false },
					depth: { active: true, char: ' ' },
				},
				styles: {
					blue: { active: true, style: 'color: steelblue;' },
					gray: { active: true, style: 'color: gray;' },
					orange: { active: true, style: 'color: orange;' },
					red: { active: true, style: 'color: red;' },
					white: { active: true, style: 'color: white;' },
					yellow: { active: true, style: 'color: yellow;' },
				},

				// @b Private
				//------------------------

				// Depth
				_depth: 0,

				// Should log
				_shouldLog() {
					return this.config.active && this._depth <= this.config.maxDepth
				},

				// Get indent
				_getIndent() {
					return this.config.depth.active ? this.config.depth.char.repeat(this._depth) : ''
				},

				// Get caller info
				_getCallerInfo: (idx) => {
					const line = new Error().stack?.split('\n')[idx]?.trim() || ''
					const match = line.match(/at\s+(.+?)\s+\((.+)\)/) || line.match(/^(.+?)@(.+)/)
					if (!match) return { caller: '', location: '' }

					const fullName = match[1]
					const parts = fullName.split('.')
					const caller = parts.pop()
					const fullPath = match[2] || match[1]
					const loc = fullPath.match(/([^\/\\]+):(\d+):\d+/)
					const location = loc ? `${loc[1]}:${loc[2]}` : ''
					return { caller, location }
				},

				// Format args
				_formatArgs: (args) =>
					args
						.map((a) =>
							a instanceof HTMLElement ? `[${a.tagName}]` : typeof a === 'object' ? JSON.stringify(a, null, 2) : a
						)
						.join(', '),

				// Enter with style
				_enterWithStyle(color, ...data) {
					if (!this.config.active || !this.styles[color]?.active) return

					const indent = this._getIndent()
					const { caller, location } = this._getCallerInfo(4)

					if (this._depth <= this.config.maxDepth) {
						const formatted = data.length > 0 ? this._formatArgs(data) : ''
						const message = `${indent}â†’ ${caller}(${formatted})`
						console.log(`%c${message}`, this.styles[color].style)

						if (this.config.location.active) {
							console.log(`${indent}%câ†’ ${location}`, this.config.location.style)
						}
					}
					this._depth++
				},

				// Start with style
				_startWithStyle(color, text = null) {
					if (!this._shouldLog() || !this.config.group.active || !this.styles[color]?.active) return

					const indent = this._getIndent()
					const displayText = text !== null ? text : this._getCallerInfo(5).caller
					const method = this.config.group.collapsed ? console.groupCollapsed : console.group

					const combinedStyle = `${this.config.group.style} ${this.styles[color].style}`
					method(`${indent}%c${displayText}`, combinedStyle)
				},

				// Styled
				_styled(mode, ...args) {
					if (!this._shouldLog() || !this.styles[mode]?.active) return
					const { location } = this._getCallerInfo(4)
					const content = this._formatArgs(args)
					const style = this.styles[mode].style
					const indent = this._getIndent()

					let message = `${indent}%c${content}`
					let styles = [style]

					if (this.config.location.active) {
						message += `\n${indent}%câ†’ ${location}`
						styles.push(this.config.location.style)
					}
					console.log(message, ...styles)
				},

				// @b Public
				//------------------------

				// Enter
				enter(...data) {
					if (!this.config.active) return

					const indent = this._getIndent()
					const { caller, location } = this._getCallerInfo(3)

					if (this._depth <= this.config.maxDepth) {
						const formatted = data.length > 0 ? this._formatArgs(data) : ''
						console.log(`${indent}â†’ ${caller}(${formatted})`)

						if (this.config.location.active) {
							console.log(`${indent}%câ†’ ${location}`, this.config.location.style)
						}
					}
					this._depth++
				},

				// Exit
				exit() {
					if (!this.config.active) return
					this._depth = Math.max(0, this._depth - 1)
				},

				// Start
				start(text = null) {
					if (!this._shouldLog() || !this.config.group.active) return

					const indent = this._getIndent()
					const displayText = text !== null ? text : this._getCallerInfo(3).caller
					const method = this.config.group.collapsed ? console.groupCollapsed : console.group

					method(`${indent}%c${displayText}`, `${this.config.group.style} color: yellow;`)
				},

				// End
				end() {
					if (!this.config.active || !this.config.group.active) return
					console.groupEnd()
				},

				// Default
				default(...args) {
					if (!this._shouldLog()) return
					const indent = this._getIndent()
					console.log(indent, ...args)
					if (this.config.location.active) {
						const { location } = this._getCallerInfo(3)
						console.log(`${indent}%câ†‘ ${location}`, this.config.location.style)
					}
				},

				// Error
				error(...args) {
					if (!this._shouldLog()) return
					const indent = this._getIndent()
					console.error(indent, ...args)
				},

				// Warn
				warn(...args) {
					if (!this._shouldLog()) return
					const indent = this._getIndent()
					console.warn(indent, ...args)
				},

				// Divider
				divider(text = '') {
					if (!this._shouldLog() || !this.config.divider.active) return

					const char = this.config.divider.char
					const style = this.config.divider.style
					const indent = this._getIndent()

					if (text) {
						console.log(`${indent}%c${text}\n${indent}${char.repeat(text.length)}`, style)
					} else {
						console.log(`${indent}%c${char.repeat(this.config.divider.length)}`, style)
					}
				},

				// Init
				init() {
					Object.keys(this.styles).forEach((color) => {
						this[color] = (...args) => this._styled(color, ...args)
						this.start[color] = (text = null) => this._startWithStyle(color, text)
						this.enter[color] = (...data) => this._enterWithStyle(color, ...data)
					})
				},
			}
		</script>
		<!--#endregion -->
	</body>
</html>
